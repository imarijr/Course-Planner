(function(angular){
'use strict';
angular
    .module('root', [
        'common',
        'components',
        'templates',
        'ngMaterial'
    ]);})(window.angular);
(function(angular){
'use strict';
angular 
    .module('components', 
    ['components.home',
    'components.semesters',
    'components.addclass',
    'ngMaterial'
]); })(window.angular);
(function(angular){
'use strict';
angular
  .module('common', [
    'ui.router',
    'ngMaterial',
    'ngParse',
  ])
  .run(function () {
    console.log("common module")
  });})(window.angular);
(function(angular){
'use strict';
angular
    .module('components.addclass', [
        'ui.router',
        'ngMaterial'
        
    ]);})(window.angular);
(function(angular){
'use strict';
angular
    .module('components.home', [
        'ui.router',
        'ngMaterial'
        
    ]);})(window.angular);
(function(angular){
'use strict';
angular
    .module('components.semesters', [
        'ui.router',
        'ngMaterial',
        'ui.sortable'
        
    ]);})(window.angular);
(function(angular){
'use strict';
var root = {
    templateUrl: './root.html'
  };
  
  angular
    .module('root')
    .component('root', root);



})(window.angular);
(function(angular){
'use strict';
var appNav = {
    templateUrl: './app-nav.html'
  };
  
  angular
    .module('common')
    .component('appNav', appNav);})(window.angular);
(function(angular){
'use strict';
var app = {
    templateUrl: './app.html',
    controller: 'AppController'
  };
  
  angular
    .module('common')
    .component('app', app)
    .config(["$stateProvider", function ($stateProvider) {
      $stateProvider
        .state('app', {
              redirectTo:  "home",
              url: '/',
              component: 'app',

            }
          
        )
    }]);})(window.angular);
(function(angular){
'use strict';
config.$inject = ["ParseProvider"];
function config(ParseProvider) {
  ParseProvider.serverURL = 'https://parseapi.back4app.com'; // This is your Server URL
  ParseProvider.initialize(
    'UZwpFbGYPWGGKsVAt5vRzPbH1lSdX6u77OF3KrD5', // This is your Application ID
    'IpK6jyzdSSOGfqfM5SbA90UmakjLChfbEjcaPFBS' // This is your Javascript key
  );
}

angular.module('common').config(config);})(window.angular);
(function(angular){
'use strict';
  AppController.$inject = ["$state"];
function AppController($state) {
    var ctrl = this;
    console.log("app controller")
  }
  
  angular
    .module('common')
    .controller('AppController', AppController);})(window.angular);
(function(angular){
'use strict';
init.$inject = ["$uiRouter"];
function init( $uiRouter){
    var Visualizer = window['ui-router-visualizer'].Visualizer;
    var plugInstance = $uiRouter.plugin(Visualizer);
}

angular.module('common').run(init)})(window.angular);
(function(angular){
'use strict';
var addclass = {
    templateUrl: './addclass.html',
    controller: 'AddClassController',

}

angular
    .module('components.addclass')
    .component('addclass', addclass)
    .config(["$stateProvider", function ($stateProvider) {
        $stateProvider.state('addclass', {
            parent: 'app',
            url: 'addclass',
            component: 'addclass'
        })
    }])

    })(window.angular);
(function(angular){
'use strict';
  AddClassController.$inject = ["$state", "$mdDialog", "$http", "JSONService", "CourseModel"];
function AddClassController($state, $mdDialog, $http, JSONService, CourseModel) {
    var ctrl = this;

    // JSONService.getClassData().then((JSONdata) => {
    //   // all of the json data
    //   ctrl.classData = JSONdata;
      
    //   console.log('All Class Data:', JSONdata)
    //   console.log(JSONdata.data.major[0])
    //   console.log("add class controller")

    //   // get all the majors in the addClass.json 
    //   ctrl.jsonmajors = JSONdata.data.major[0]
    //   ctrl.majors = []
    //   angular.forEach(ctrl.jsonmajors, function (value, key) {
    //     ctrl.majors.push(key)
    //   })

    //   // go through each of the classes of the major to get the name
    //   ctrl.allClasses = []
    //   angular.forEach(ctrl.majors, function (key) {
    //     angular.forEach(ctrl.jsonmajors[key]['courses'][0], function(key) {
    //       ctrl.allClasses.push(key)
    //     })
    //   })

    ctrl.allClasses = []
    CourseModel.getCourses().then(function(courses) {
      console.log('courses: ', courses); 
      for (var i = 0; i < courses.length; i++) {
        if (courses[i].attributes.semesterDefault == null) {
          ctrl.allClasses.push(courses[i])
          console.log(courses[i].attributes.courseName)
        }
      }
      console.log('courses listed...', ctrl.allClasses)
    }).catch(function() {
      console.log("couldn't fetch courses")
    })

      console.log('courses listed...', ctrl.allClasses)

      // go through each of the classes to get the description of the class
      ctrl.doSecondaryAction = function(event, description) {
          $mdDialog.show(
            $mdDialog.alert()
              .title("Course Description")
              .textContent(description)
              .ok('Ok')
              .targetEvent(event)
          );
      };

      ctrl.addCourseToSemester = function(event, course) {
        CourseModel.getByName(course).then(function(course) {
          console.log('course found. id: ', course.id);
          console.log('sending id to setSemesterDefault')
          CourseModel.setSemesterDefault(course.id, 3).then(function(success) {
            console.log('set new default')
          }).catch(function () {
            console.log('failed to set new default.'); 
          })
        }).catch(function() {
          console.log("could not find course")
        })
      }


  }
  
angular
    .module('components.addclass')
    .controller('AddClassController', AddClassController);})(window.angular);
(function(angular){
'use strict';
/* defines the home component, the first page the user sees */
var home = {
    templateUrl: './home.html',
    controller: 'HomeController',

}

angular
    .module('components.home')
    .component('home', home)
    .config(["$stateProvider", "$urlRouterProvider", function ($stateProvider, $urlRouterProvider) {
        $stateProvider.state('home', {
            parent: 'app',
            url: 'home',
            component: 'home'
        })
    $urlRouterProvider.otherwise('/');
    }]); 

    })(window.angular);
(function(angular){
'use strict';
// display the major options in the dropdown of home
  HomeController.$inject = ["$state", "MajorModel"];
function HomeController($state, MajorModel) {
//function HomeController($state) {
    var ctrl = this;
      this.$onInit = function () {
      console.log("home controller")
      // ctrl.majors = ['Computer Science', 'Computer Engineering']
      let majors_list = []
      MajorModel.getMajors().then(function(majors) {
        for (var i = 0; i < majors.length; i++) {
          majors_list.push(majors[i].attributes.majorName)
        }
        ctrl.majors = majors_list;
      })
      //console.log(MajorModel.getById('1ZCcvgo8N6'))
    }
  }


angular
    .module('components.home')
    .controller('HomeController', HomeController);})(window.angular);
(function(angular){
'use strict';
var semesters = {
    templateUrl: './semesters.html',
    controller: 'SemestersController',

}

angular
    .module('components.semesters')
    .component('semesters', semesters)
    .config(["$stateProvider", function ($stateProvider) {
        $stateProvider.state('semesters', {
            parent: 'app',
            url: 'semesters',
            component: 'semesters'
        })
    }])

    })(window.angular);
(function(angular){
'use strict';
SemestersController.$inject = ["$http", "$mdDialog", "JSONService", "CourseModel", "$window"];
function SemestersController($http, $mdDialog, JSONService, CourseModel, $window) {
    var ctrl = this;
    console.log("semesters controller")

    function populateLists(CourseModel) {
        ctrl.models = {
            selected: null,
            semesters: {
                1: [],
                2: [],
                3: [],
                4: [],
                5: [],
                6: [],
                7: [],
                8: []
            },
            prereqs: {}, // will be key value pair of class name and prereqs list 
            names: {},
            credits: {},
            creditTotal: [0, 0, 0, 0, 0, 0, 0, 0],
            conflictingClasses: []
        };
        // sem 1 
        console.log("populating lists")
        var courses =  CourseModel.getCourseBySem(1).then(function(courses) {
            for (var idx=0; idx<courses.length; idx++) {
                var className = courses[idx].attributes.courseName;   // ie "Calculus II" 
                ctrl.models.semesters[1].push(className);
                ctrl.models.prereqs[className] = courses[idx].attributes.prerequisites;     // ie ["MATH 10550"]
                ctrl.models.names[className] = courses[idx].attributes.courseId;            // ie "MATH 10560"
                ctrl.models.credits[className] = courses[idx].attributes.credits;           // ie 3
                ctrl.models.creditTotal[0] += courses[idx].attributes.credits;
            }
        })

        // sem 2 
        courses =  CourseModel.getCourseBySem(2).then(function(courses) {
            for (var idx=0; idx<courses.length; idx++) {
                var className = courses[idx].attributes.courseName;   // ie "Calculus II" 
                ctrl.models.semesters[2].push(className);
                ctrl.models.prereqs[className] = courses[idx].attributes.prerequisites;     // ie ["MATH 10550"]
                ctrl.models.names[className] = courses[idx].attributes.courseId;            // ie "MATH 10560"
                ctrl.models.credits[className] = courses[idx].attributes.credits;           // ie 3
                ctrl.models.creditTotal[1] += courses[idx].attributes.credits;
            }
        })

        // sem 3 
        courses =  CourseModel.getCourseBySem(3).then(function(courses) {
            for (var idx=0; idx<courses.length; idx++) {
                var className = courses[idx].attributes.courseName;   // ie "Calculus II" 
                ctrl.models.semesters[3].push(className);
                ctrl.models.prereqs[className] = courses[idx].attributes.prerequisites;     // ie ["MATH 10550"]
                ctrl.models.names[className] = courses[idx].attributes.courseId;            // ie "MATH 10560"
                ctrl.models.credits[className] = courses[idx].attributes.credits;           // ie 3
                ctrl.models.creditTotal[2] += courses[idx].attributes.credits;
            }
        })

        // sem 4
        courses =  CourseModel.getCourseBySem(4).then(function(courses) {
            for (var idx=0; idx<courses.length; idx++) {
                var className = courses[idx].attributes.courseName;   // ie "Calculus II" 
                ctrl.models.semesters[4].push(className);
                ctrl.models.prereqs[className] = courses[idx].attributes.prerequisites;     // ie ["MATH 10550"]
                ctrl.models.names[className] = courses[idx].attributes.courseId;            // ie "MATH 10560"
                ctrl.models.credits[className] = courses[idx].attributes.credits;           // ie 3
                ctrl.models.creditTotal[3] += courses[idx].attributes.credits;
            }
        })

        // sem 5
        courses =  CourseModel.getCourseBySem(5).then(function(courses) {
            for (var idx=0; idx<courses.length; idx++) {
                var className = courses[idx].attributes.courseName;   // ie "Calculus II" 
                ctrl.models.semesters[5].push(className);
                ctrl.models.prereqs[className] = courses[idx].attributes.prerequisites;     // ie ["MATH 10550"]
                ctrl.models.names[className] = courses[idx].attributes.courseId;            // ie "MATH 10560"
                ctrl.models.credits[className] = courses[idx].attributes.credits;           // ie 3
                ctrl.models.creditTotal[4] += courses[idx].attributes.credits;
            }
        })

        // sem 6
        courses =  CourseModel.getCourseBySem(6).then(function(courses) {
            for (var idx=0; idx<courses.length; idx++) {
                var className = courses[idx].attributes.courseName;   // ie "Calculus II" 
                ctrl.models.semesters[6].push(className);
                ctrl.models.prereqs[className] = courses[idx].attributes.prerequisites;     // ie ["MATH 10550"]
                ctrl.models.names[className] = courses[idx].attributes.courseId;            // ie "MATH 10560"
                ctrl.models.credits[className] = courses[idx].attributes.credits;           // ie 3
                ctrl.models.creditTotal[5] += courses[idx].attributes.credits;
            }
        })

        // sem 7
        courses =  CourseModel.getCourseBySem(7).then(function(courses) {
            for (var idx=0; idx<courses.length; idx++) {
                var className = courses[idx].attributes.courseName;   // ie "Calculus II" 
                ctrl.models.semesters[7].push(className);
                ctrl.models.prereqs[className] = courses[idx].attributes.prerequisites;     // ie ["MATH 10550"]
                ctrl.models.names[className] = courses[idx].attributes.courseId;            // ie "MATH 10560"
                ctrl.models.credits[className] = courses[idx].attributes.credits;           // ie 3
                ctrl.models.creditTotal[6] += courses[idx].attributes.credits;
            }
        })

        // sem 8
        courses =  CourseModel.getCourseBySem(8).then(function(courses) {
            for (var idx=0; idx<courses.length; idx++) {
                var className = courses[idx].attributes.courseName;   // ie "Calculus II" 
                ctrl.models.semesters[8].push(className);
                ctrl.models.prereqs[className] = courses[idx].attributes.prerequisites;     // ie ["MATH 10550"]
                ctrl.models.names[className] = courses[idx].attributes.courseId;            // ie "MATH 10560"
                ctrl.models.credits[className] = courses[idx].attributes.credits;           // ie 3
                ctrl.models.creditTotal[7] += courses[idx].attributes.credits;
            }
        })

    }

    function calculateCreditTotalsPrereqs() {
        angular.forEach(ctrl.models.semesters, function (value, key) {
            for (let i=0; i<value.length; i++) {
                ctrl.models.creditTotal[key-1] += ctrl.models.credits[ctrl.models.semesters[key][i]]
            }
        })


        // Connects semester lists for drap and drop
        ctrl.classWarning = false

        ctrl.courseMap = {
            stop: function (e, ui) {
                //reset creditTotals
                console.log("calculating credits")
                ctrl.models.creditTotal = [0, 0, 0, 0, 0, 0, 0, 0]
                ctrl.classWarning = false
                //console.log("Updated Course Map", JSON.stringify(ctrl.models.semesters, undefined, 2))
                var currentClasses = []
                // loop through semesters
                for (let i = 1; i < 9; i++) {
                    length = ctrl.models.semesters[i].length

                    // loop through classes
                    for (let j = 0; j < length; j++) {
                        // calculate new credit totals
                        ctrl.models.creditTotal[i - 1] += ctrl.models.credits[ctrl.models.semesters[i][j]]

                        // make sure that moves get saved to parse - save each class+semester
                        CourseModel.getByName(ctrl.models.semesters[i][j]).then(function(course) {
                            console.log("course back from get by name: ", course)
                            CourseModel.setSemesterDefault(course.id, i).then(function(success) {
                            console.log("success!")
                            });
                        })
                        var prereqs = ctrl.models.prereqs[ctrl.models.semesters[i][j]]
                        if (prereqs != null) {
                            var plength = prereqs.length
                            // loop through prerequisites 
                            for (let m = 0; m < plength; m++) {
                                if (currentClasses.includes(prereqs[m]) == false) {
                                    console.log("breaking a prerequisities rule: ") // if prereq not in "taken" classes
                                    console.log(prereqs[m])
                                    ctrl.classWarning = true
                                    console.log(ctrl.classWarning)
                                }
                            }
                        }
                    }

                    // append on all classes you've taken so far, including this semester
                    for (let k = 0; k < length; k++) {
                        var classnum = ctrl.models.names[ctrl.models.semesters[i][k]]
                        currentClasses.push(classnum)

                    }
                }
                console.log("Credits: ", ctrl.models.creditTotal)
            },
            placeholder: "course",
            connectWith: ".course-list"
        }
    }

    populateLists(CourseModel); 
    calculateCreditTotalsPrereqs(); 
    
    ctrl.addClass = function(event, semester) {
        console.log('semester: ', semester)
        var config = {
            parent: angular.element(document.body),
            controller: AddClassController,
            controllerAs: '$ctrl',
            disableParentScroll: true, 
            templateUrl: './addclass.html',
            hasBackdrop: true, 
            trapFocus: true, 
            clickOutsideToClose: true, 
            escapeToClose: true, 
            focusOnOpen: true,
            fullscreen: true, 
            targetEvent: event
        }

        $mdDialog.show(config)
            .then(answer => {
                console.log('answer: ', answer); 
            })


    function AddClassController($state, $mdDialog, $http, JSONService, CourseModel, $window) {
        var ctrl = this;
        console.log("running controller")
        ctrl.allClasses = []
        CourseModel.getCourses().then(function(courses) {
        console.log('courses: ', courses); 
        for (var i = 0; i < courses.length; i++) {
            if (courses[i].attributes.semesterDefault == null) {
            ctrl.allClasses.push(courses[i])
            console.log(courses[i].attributes.courseName)
            }
        }
        console.log('courses listed...', ctrl.allClasses)
        }).catch(function() {
        console.log("couldn't fetch courses")
        })

        console.log('courses listed...', ctrl.allClasses)

        // go through each of the classes to get the description of the class
        ctrl.doSecondaryAction = function(event, description) {
            $mdDialog.show(
                $mdDialog.alert()
                .title("Course Description")
                .textContent(description)
                .ok('Ok')
                .targetEvent(event)
            );
        };

        ctrl.addCourseToSemesterWrapper = function(event, course, $window) {
            addCourseToSemester(event, course).then(function(success){
                $mdDialog.cancel(); 
                $window.location.reload();
            })
        }

        //ctrl.addCourseToSemester = function(event, course) {
        function addCourseToSemester(event, course) {
            console.log("starting?")
            CourseModel.getByName(course).then(function(course) {
            console.log('course found. id: ', course.id);
            console.log('sending id to setSemesterDefault')
            CourseModel.setSemesterDefault(course.id, parseInt(semester)).then(function(success) {
                console.log('set new default')
                }).catch(function () {
                    populateLists(CourseModel);
                    console.log('failed to set new default.'); 
                })
            }).catch(function() {
            })
        }
    }
}


    // delete class "controller"
    ctrl.deleteClass = function(event, semester) {
        console.log('semester: ', semester)
        var config = {
            parent: angular.element(document.body),
            controller: DeleteClassController,
            controllerAs: '$ctrl',
            disableParentScroll: true, 
            templateUrl: './deleteclass.html',
            hasBackdrop: true, 
            trapFocus: true, 
            clickOutsideToClose: true, 
            escapeToClose: true, 
            focusOnOpen: true,
            fullscreen: true, 
            targetEvent: event
        }

        $mdDialog.show(config)
            .then(answer => {
                console.log('answer: ', answer); 
            })


    function DeleteClassController($state, $mdDialog, $http, JSONService, CourseModel, $window) {
        var ctrl = this;
        ctrl.allClasses = []
        console.log("semester...? ", semester)
        CourseModel.getCourseBySem(parseInt(semester)).then(function(courses) {
        console.log('courses: ', courses); 
        for (var i = 0; i < courses.length; i++) {
            ctrl.allClasses.push(courses[i])
            console.log(courses[i].attributes.courseName)
        }
        console.log('courses listed...', ctrl.allClasses)
        }).catch(function() {
        console.log("couldn't fetch courses")
        })

        console.log('courses listed...', ctrl.allClasses)

        // go through each of the classes to get the description of the class
        ctrl.doSecondaryAction = function(event, description) {
            $mdDialog.show(
                $mdDialog.alert()
                .title("Course Description")
                .textContent(description)
                .ok('Ok')
                .targetEvent(event)
            );
        };

        ctrl.addCourseToSemesterWrapper = function(event, course, $window) {
            addCourseToSemester(event, course).then(function(success){
                $mdDialog.cancel(); 
                $window.location.reload();
            })
        }

        //ctrl.addCourseToSemester = function(event, course) {
        ctrl.removeCourseFromSemester = function(event, course) {
            console.log("starting?")
            CourseModel.getByName(course).then(function(course) {
            console.log('course found. id: ', course.id);
            console.log('sending id to setSemesterDefault')
            CourseModel.removeSemesterDefault(course.id).then(function(success) {
                console.log('set new default')
                }).catch(function () {
                    populateLists(CourseModel);
                    console.log('failed to set new default.'); 
                })
            }).catch(function() {
            })
        }
    }    


}
}


angular
    .module('components.semesters')
    .controller('SemestersController', SemestersController);})(window.angular);
(function(angular){
'use strict';
/**
 * @ngdoc service
 * @name common.service:CourseModel
 *
 * @description Model and helper methods for CourseModel parse object.
 */

class CourseModel {
    constructor(Parse, MajorModel) {
        this.Parse = Parse;
        this.MajorModel = MajorModel
        this.data = {};
        this.collection = [];
        this.name = 'Course';
        this.fields = [
            'courseName',
            'corequisites',
            'semesterDefault', 
            'courseId',
            'semesterRequired',
            'attributes',
            'defaultMajor',
            'credits',
            'prerequisites'
        ];
    }
    New(obj) {
        if (angular.isUndefined(obj)) {
            const parseObject = new this.Parse.Object(this.name);
            this.Parse.defineAttributes(parseObject, this.fields);
            // parseObject.major = new this.Parse.Object(this.MajorModel.name)
            // this.Parse.defineAttributes(parseObject.major); 
            return parseObject;
        } else {
            this.Parse.defineAttributes(obj, this.fields);
            // this.Parse.defineAttributes(obj.major, this.MajorModel.fields); 
            return obj;
        }
    }
    getById(id) {
        console.log(id)
        return new this.Parse.Query(this.New())
            .equalTo("objectId", id)
            .find()
            .then(result => {
                console.log('result', result)
                this.Parse.defineAttributes(result, this.fields);
                this.data = result;
                return Promise.resolve(result);
            })
            .catch(error => Promise.reject(error));
    }

    getByName(name) {
        console.log("name passed in: ", name)
        return new this.Parse.Query(this.New())
            .equalTo("courseName", name)
            .find()
            .then(result => {
                console.log('result: ', result[0]);         // no two courses should have the same name
                                                                    // so should only be one result
                //this.Parse.defineAttributes(result[0], this.fields); 
                //this.data = result[0]; 
                return Promise.resolve(result[0]); 
            })
            .catch(error => Promise.reject(error))
    }

    getByMajor(major) {
        return new this.Parse.Query(this.New())
            .include('major')
            .equalTo('major', major)
            .find()
            .then(courses => {
                courses.forEach(course => {
                    this.Parse.defineAttributes(course, this.fields);
                    this.Parse.defineAttributes(course.major, this.CourseModel.fields);
                })
                this.collection = courses;
                console.log("getByMajor", this.collection)
                return Promise.resolve(courses);
            })
            .catch(error => Promise.reject(error));
    }

    setSemesterDefault(id, sem) {
        myobj = new this.Parse.Query(this.New())
            .get(id)
            .then(result => {
                // this.Parse.defineAttributes(result, this.fields);
                // this.data = result; 
                result.set("semesterDefault", sem); 
                console.log('new default should be 3: ', result); 
                result.save(); 
                return Promise.resolve(result); 
            }).catch(error => Promise.reject(error))
    }

    removeSemesterDefault(id) {
        myobj = new this.Parse.Query(this.New())
            .get(id)
            .then(result => {
                // this.Parse.defineAttributes(result, this.fields);
                // this.data = result; 
                result.set("semesterDefault", null); 
                console.log('new default should be 3: ', result); 
                result.save(); 
                return Promise.resolve(result); 
            }).catch(error => Promise.reject(error))
    }

    getCourseBySem(semDef) {
        return new this.Parse.Query(this.New())
            .equalTo("semesterDefault", semDef)
            .find().then(result => {
                this.data = result;
                console.log("result of getCourseBySem: ", result);
                return Promise.resolve(result);
            })
            .catch(error => Promise.reject(error));
    }

    getCourses() {
        return new this.Parse.Query(this.New())
            .find().then(result => {
                return Promise.resolve(result); 
            })
            .catch(error => Promise.reject(error)); 
    }
}

angular
    .module('common')
    .service('CourseModel', CourseModel);
})(window.angular);
(function(angular){
'use strict';
/**
 * @ngdoc service
 * @name common.service:MajorModel
 *
 * @description Model and helper methods for MajorModel parse object.
 */

class MajorModel {
    constructor(Parse) {
        this.Parse = Parse;
        this.data = {};
        this.collection = [];
        this.name = 'Major';
        this.fields = [
            'credits',
            'majorName',
            'college'
        ];
    }
    New(obj) {
        if (angular.isUndefined(obj)) {
            const parseObject = new this.Parse.Object(this.name)
            this.Parse.defineAttributes(parseObject, this.fields);
            return parseObject;
        } else {
            this.Parse.defineAttributes(obj, this.fields);
            return obj;
        }
    }
    getById(id) {
        return new this.Parse.Query(this.New())
            .get(id)
            .then(result => {
                console.log('result', result)
                this.Parse.defineAttributes(result, this.fields);
                this.data = result;
                return Promise.resolve(result);
            })
            .catch(error => Promise.reject(error));
    }
    getByName(name) {
        return new this.Parse.Query(this.New())
            .equalTo("majorName", name)
            .find().then(result => {
                console.log('result', result)
                this.Parse.defineAttributes(result, this.fields); 
                this.data = result; 
                return Promise.resolve(result); 
            })
            .catch(error => Promise.reject(error))
    }
    getMajors() {
        return new this.Parse.Query(this.New())
        .find().then(result => {
            this.data = result
            return Promise.resolve(result);
        })
        .catch(error => Promise.reject(error));
    }
}

angular
    .module('common')
    .service('MajorModel', MajorModel);
})(window.angular);
(function(angular){
'use strict';
class JSONService {
    constructor($http){
        this.$http = $http
    }

    getSemesterData() {
        return this.$http({
            method: 'GET',
            url: '../data.json',
        })
    }
    getClassData() {
        return this.$http({
            method: 'GET',
            url: '../addClass.json',
        })
    }

}

angular
    .module('common')
    .service('JSONService', JSONService);})(window.angular);
(function(angular){
'use strict';
angular.module('templates', []).run(['$templateCache', function($templateCache) {$templateCache.put('./root.html','<div class="root">\n    <div ui-view></div>\n</div>');
$templateCache.put('./app-nav.html','<header>\n  <md-toolbar>\n      <div class="md-toolbar-tools" layout="row" layout-align="space-between center">\n          <div>\n              <a href="#"><i class="material-icons">home</i></a>\n          </div>\n          <div>\n              <h3>Course Planner</h3>\n          </div>\n      </div>\n  </md-toolbar>\n</header>');
$templateCache.put('./app.html','<div class="root">\n  <div>\n    <div ui-view></div>\n  </div>\n</div>');
$templateCache.put('./home.html','<app-nav></app-nav>\n<md-input-container class="md-block" flex-gt-sm>\n    <h2>Choose your major to get started.</h2>\n    <label>My Major</label>\n    <md-select ng-model="majorChosen" ng-change="onChange()">\n      <!-- stateful component -->\n      <md-option ng-repeat="major in $ctrl.majors" value="{{major}}">\n        {{major}}\n      </md-option>\n    </md-select>\n  </md-input-container>\n\n  <md-button md-no-ink class="md-go-button" ng-click = "saveMajor()" href="#!/semesters">Go</md-button>');
$templateCache.put('./addclass.html','<!-- stateful component -->\n  <md-input-container class="md-block-addclass" flex-gt-sm>\n      <h1 class="additional-options">Additional Class Options</h1> \n    <!-- stateless component -->\n    <md-list-item ng-repeat="course in $ctrl.allClasses" value="{{course.attributes.courseName}}" class="secondary-button-padding-class">\n      <p>{{course.attributes.courseName}}</p>\n      <md-button class="md-secondary" ng-click="$ctrl.addCourseToSemesterWrapper($event, course.attributes.courseName)" href="#!/semesters">add class</md-button>\n    </md-list-item>\n  </md-input-container>\n');
$templateCache.put('./deleteclass.html','<!-- stateful component -->\n<md-input-container class="md-block-addclass" flex-gt-sm>\n    <h1 class="additional-options">Remove Class</h1> \n  <!-- stateless component -->\n  <md-list-item ng-repeat="course in $ctrl.allClasses" value="{{course.attributes.courseName}}" class="secondary-button-padding-class">\n    <p>{{course.attributes.courseName}}</p>\n    <md-button class="md-secondary" ng-click="$ctrl.removeCourseFromSemester($event, course.attributes.courseName)" href="#!/semesters">remove class</md-button>\n  </md-list-item>\n</md-input-container>\n');
$templateCache.put('./semesters.html','<app-nav></app-nav>\n<div class="course-map">\n    <md-content layout-padding>\n        <div ng-show="$ctrl.classWarning" class="warning-text">\n            One or more classes need adjusting to satisfy prerequisite requirements. \n        </div>\n        <!-- Grid List to Keep even layout -->\n        <md-grid-list  md-cols-sm="1" md-cols-md="1" md-cols-lg="2" md-cols-gt-lg="3" md-cols=1 md-row-height-md="1:1" md-row-height="1.2:1"\n            md-gutter-gt-md="16px" md-gutter-md="8px" md-gutter="4px">\n            <!-- Each Tile holds a list of semester courses -->\n            <!-- stateful component -->\n            <md-grid-tile ng-repeat="(key, semester) in $ctrl.models.semesters">\n                <!-- ui-sortable allows drag drop sorting of \n                    arrays courseMap is the drag drop group -->\n                    <!-- stateless component -->\n                <md-list ui-sortable="$ctrl.courseMap" class="course-list" ng-model="semester">\n                    <md-subheader class="md-no-sticky">Semester {{$index+1}}</md-subheader>\n                    <!-- repeats each class in a semester -->\n                    <md-list-item ng-repeat="item in semester" class="md-2-line course">\n                        <div class="md-list-item-text">\n                            {{item}}\n                        </div>\n                        <md-divider></md-divider>\n                    </md-list-item>\n                    <!-- display the running total of credits for each semester-->\n                    <div style="margin: 30px"></div>\n                    <p>Credits: {{$ctrl.models.creditTotal[$index]}}\n                    <md-button style="float: right; margin-top: -10px" ng-click = "$ctrl.deleteClass($event, key)">Delete Class</md-button>\n                    <md-button style="float: right; margin-top: -10px" ng-click = "$ctrl.addClass($event, key)">Add Class</md-button></p>\n                </md-list>\n            </md-grid-tile>\n        </md-grid-list>\n    </md-content>\n</div>');}]);})(window.angular);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJvb3QubW9kdWxlLmpzIiwiY29tcG9uZW50cy9jb21wb25lbnRzLm1vZHVsZS5qcyIsImNvbW1vbi9hcHAubW9kdWxlLmpzIiwiY29tcG9uZW50cy9hZGRjbGFzcy9hZGRjbGFzcy5tb2R1bGUuanMiLCJjb21wb25lbnRzL2hvbWUvaG9tZS5tb2R1bGUuanMiLCJjb21wb25lbnRzL3NlbWVzdGVycy9zZW1lc3RlcnMubW9kdWxlLmpzIiwicm9vdC5jb21wb25lbnQuanMiLCJjb21tb24vYXBwLW5hdi5jb21wb25lbnQuanMiLCJjb21tb24vYXBwLmNvbXBvbmVudC5qcyIsImNvbW1vbi9hcHAuY29uZmlnLmpzIiwiY29tbW9uL2FwcC5jb250cm9sbGVyLmpzIiwiY29tbW9uL2FwcC5ydW4uanMiLCJjb21wb25lbnRzL2FkZGNsYXNzL2FkZGNsYXNzLmNvbXBvbmVudC5qcyIsImNvbXBvbmVudHMvYWRkY2xhc3MvYWRkY2xhc3MuY29udHJvbGxlci5qcyIsImNvbXBvbmVudHMvaG9tZS9ob21lLmNvbXBvbmVudC5qcyIsImNvbXBvbmVudHMvaG9tZS9ob21lLmNvbnRyb2xsZXIuanMiLCJjb21wb25lbnRzL3NlbWVzdGVycy9zZW1lc3RlcnMuY29tcG9uZW50LmpzIiwiY29tcG9uZW50cy9zZW1lc3RlcnMvc2VtZXN0ZXJzLmNvbnRyb2xsZXIuanMiLCJjb21tb24vc2VydmljZXMvQ291cnNlLm1vZGVsLmpzIiwiY29tbW9uL3NlcnZpY2VzL01ham9yLm1vZGVsLmpzIiwiY29tbW9uL3NlcnZpY2VzL2pzb24uc2VydmljZS5qcyIsInRlbXBsYXRlcy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxDQUFBLFNBQUEsUUFBQTtBQUNBO0FBQ0E7S0FDQSxPQUFBLFFBQUE7UUFDQTtRQUNBO1FBQ0E7UUFDQTtVQUNBLE9BQUE7QUNSQSxDQUFBLFNBQUEsUUFBQTtBQUNBO0FBQ0E7S0FDQSxPQUFBO0lBQ0EsQ0FBQTtJQUNBO0lBQ0E7SUFDQTtPQUNB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QUFDQSxTQUFBLG9CQUFBLE9BQUEsV0FBQSxhQUFBLGFBQUEsU0FBQTtJQUNBLElBQUEsT0FBQTtJQUNBLFFBQUEsSUFBQTs7SUFFQSxTQUFBLGNBQUEsYUFBQTtRQUNBLEtBQUEsU0FBQTtZQUNBLFVBQUE7WUFDQSxXQUFBO2dCQUNBLEdBQUE7Z0JBQ0EsR0FBQTtnQkFDQSxHQUFBO2dCQUNBLEdBQUE7Z0JBQ0EsR0FBQTtnQkFDQSxHQUFBO2dCQUNBLEdBQUE7Z0JBQ0EsR0FBQTs7WUFFQSxTQUFBO1lBQ0EsT0FBQTtZQUNBLFNBQUE7WUFDQSxhQUFBLENBQUEsR0FBQSxHQUFBLEdBQUEsR0FBQSxHQUFBLEdBQUEsR0FBQTtZQUNBLG9CQUFBOzs7UUFHQSxRQUFBLElBQUE7UUFDQSxJQUFBLFdBQUEsWUFBQSxlQUFBLEdBQUEsS0FBQSxTQUFBLFNBQUE7WUFDQSxLQUFBLElBQUEsSUFBQSxHQUFBLElBQUEsUUFBQSxRQUFBLE9BQUE7Z0JBQ0EsSUFBQSxZQUFBLFFBQUEsS0FBQSxXQUFBO2dCQUNBLEtBQUEsT0FBQSxVQUFBLEdBQUEsS0FBQTtnQkFDQSxLQUFBLE9BQUEsUUFBQSxhQUFBLFFBQUEsS0FBQSxXQUFBO2dCQUNBLEtBQUEsT0FBQSxNQUFBLGFBQUEsUUFBQSxLQUFBLFdBQUE7Z0JBQ0EsS0FBQSxPQUFBLFFBQUEsYUFBQSxRQUFBLEtBQUEsV0FBQTtnQkFDQSxLQUFBLE9BQUEsWUFBQSxNQUFBLFFBQUEsS0FBQSxXQUFBOzs7OztRQUtBLFdBQUEsWUFBQSxlQUFBLEdBQUEsS0FBQSxTQUFBLFNBQUE7WUFDQSxLQUFBLElBQUEsSUFBQSxHQUFBLElBQUEsUUFBQSxRQUFBLE9BQUE7Z0JBQ0EsSUFBQSxZQUFBLFFBQUEsS0FBQSxXQUFBO2dCQUNBLEtBQUEsT0FBQSxVQUFBLEdBQUEsS0FBQTtnQkFDQSxLQUFBLE9BQUEsUUFBQSxhQUFBLFFBQUEsS0FBQSxXQUFBO2dCQUNBLEtBQUEsT0FBQSxNQUFBLGFBQUEsUUFBQSxLQUFBLFdBQUE7Z0JBQ0EsS0FBQSxPQUFBLFFBQUEsYUFBQSxRQUFBLEtBQUEsV0FBQTtnQkFDQSxLQUFBLE9BQUEsWUFBQSxNQUFBLFFBQUEsS0FBQSxXQUFBOzs7OztRQUtBLFdBQUEsWUFBQSxlQUFBLEdBQUEsS0FBQSxTQUFBLFNBQUE7WUFDQSxLQUFBLElBQUEsSUFBQSxHQUFBLElBQUEsUUFBQSxRQUFBLE9BQUE7Z0JBQ0EsSUFBQSxZQUFBLFFBQUEsS0FBQSxXQUFBO2dCQUNBLEtBQUEsT0FBQSxVQUFBLEdBQUEsS0FBQTtnQkFDQSxLQUFBLE9BQUEsUUFBQSxhQUFBLFFBQUEsS0FBQSxXQUFBO2dCQUNBLEtBQUEsT0FBQSxNQUFBLGFBQUEsUUFBQSxLQUFBLFdBQUE7Z0JBQ0EsS0FBQSxPQUFBLFFBQUEsYUFBQSxRQUFBLEtBQUEsV0FBQTtnQkFDQSxLQUFBLE9BQUEsWUFBQSxNQUFBLFFBQUEsS0FBQSxXQUFBOzs7OztRQUtBLFdBQUEsWUFBQSxlQUFBLEdBQUEsS0FBQSxTQUFBLFNBQUE7WUFDQSxLQUFBLElBQUEsSUFBQSxHQUFBLElBQUEsUUFBQSxRQUFBLE9BQUE7Z0JBQ0EsSUFBQSxZQUFBLFFBQUEsS0FBQSxXQUFBO2dCQUNBLEtBQUEsT0FBQSxVQUFBLEdBQUEsS0FBQTtnQkFDQSxLQUFBLE9BQUEsUUFBQSxhQUFBLFFBQUEsS0FBQSxXQUFBO2dCQUNBLEtBQUEsT0FBQSxNQUFBLGFBQUEsUUFBQSxLQUFBLFdBQUE7Z0JBQ0EsS0FBQSxPQUFBLFFBQUEsYUFBQSxRQUFBLEtBQUEsV0FBQTtnQkFDQSxLQUFBLE9BQUEsWUFBQSxNQUFBLFFBQUEsS0FBQSxXQUFBOzs7OztRQUtBLFdBQUEsWUFBQSxlQUFBLEdBQUEsS0FBQSxTQUFBLFNBQUE7WUFDQSxLQUFBLElBQUEsSUFBQSxHQUFBLElBQUEsUUFBQSxRQUFBLE9BQUE7Z0JBQ0EsSUFBQSxZQUFBLFFBQUEsS0FBQSxXQUFBO2dCQUNBLEtBQUEsT0FBQSxVQUFBLEdBQUEsS0FBQTtnQkFDQSxLQUFBLE9BQUEsUUFBQSxhQUFBLFFBQUEsS0FBQSxXQUFBO2dCQUNBLEtBQUEsT0FBQSxNQUFBLGFBQUEsUUFBQSxLQUFBLFdBQUE7Z0JBQ0EsS0FBQSxPQUFBLFFBQUEsYUFBQSxRQUFBLEtBQUEsV0FBQTtnQkFDQSxLQUFBLE9BQUEsWUFBQSxNQUFBLFFBQUEsS0FBQSxXQUFBOzs7OztRQUtBLFdBQUEsWUFBQSxlQUFBLEdBQUEsS0FBQSxTQUFBLFNBQUE7WUFDQSxLQUFBLElBQUEsSUFBQSxHQUFBLElBQUEsUUFBQSxRQUFBLE9BQUE7Z0JBQ0EsSUFBQSxZQUFBLFFBQUEsS0FBQSxXQUFBO2dCQUNBLEtBQUEsT0FBQSxVQUFBLEdBQUEsS0FBQTtnQkFDQSxLQUFBLE9BQUEsUUFBQSxhQUFBLFFBQUEsS0FBQSxXQUFBO2dCQUNBLEtBQUEsT0FBQSxNQUFBLGFBQUEsUUFBQSxLQUFBLFdBQUE7Z0JBQ0EsS0FBQSxPQUFBLFFBQUEsYUFBQSxRQUFBLEtBQUEsV0FBQTtnQkFDQSxLQUFBLE9BQUEsWUFBQSxNQUFBLFFBQUEsS0FBQSxXQUFBOzs7OztRQUtBLFdBQUEsWUFBQSxlQUFBLEdBQUEsS0FBQSxTQUFBLFNBQUE7WUFDQSxLQUFBLElBQUEsSUFBQSxHQUFBLElBQUEsUUFBQSxRQUFBLE9BQUE7Z0JBQ0EsSUFBQSxZQUFBLFFBQUEsS0FBQSxXQUFBO2dCQUNBLEtBQUEsT0FBQSxVQUFBLEdBQUEsS0FBQTtnQkFDQSxLQUFBLE9BQUEsUUFBQSxhQUFBLFFBQUEsS0FBQSxXQUFBO2dCQUNBLEtBQUEsT0FBQSxNQUFBLGFBQUEsUUFBQSxLQUFBLFdBQUE7Z0JBQ0EsS0FBQSxPQUFBLFFBQUEsYUFBQSxRQUFBLEtBQUEsV0FBQTtnQkFDQSxLQUFBLE9BQUEsWUFBQSxNQUFBLFFBQUEsS0FBQSxXQUFBOzs7OztRQUtBLFdBQUEsWUFBQSxlQUFBLEdBQUEsS0FBQSxTQUFBLFNBQUE7WUFDQSxLQUFBLElBQUEsSUFBQSxHQUFBLElBQUEsUUFBQSxRQUFBLE9BQUE7Z0JBQ0EsSUFBQSxZQUFBLFFBQUEsS0FBQSxXQUFBO2dCQUNBLEtBQUEsT0FBQSxVQUFBLEdBQUEsS0FBQTtnQkFDQSxLQUFBLE9BQUEsUUFB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QTs7Ozs7Ozs7QUFRQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBc0RBO0tBQ0EsT0FBQTtLQUNBLFFBQUEsY0FBQTtHQUNBLE9BQUE7QUNsRUEsQ0FBQSxTQUFBLFFBQUE7QUFDQTtBQUNBOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9CQTtLQUNBLE9BQUE7S0FDQSxRQUFBLGVBQUEsZ0JBQUEsT0FBQTtBQ3hCQSxDQUFBLFNBQUEsUUFBQTtBQUNBO0FBQ0EsUUFBQSxPQUFBLGFBQUEsSUFBQSxJQUFBLENBQUEsa0JBQUEsU0FBQSxnQkFBQSxDQUFBLGVBQUEsSUFBQSxjQUFBO0FBQ0EsZUFBQSxJQUFBLGlCQUFBO0FBQ0EsZUFBQSxJQUFBLGFBQUE7QUFDQSxlQUFBLElBQUEsY0FBQTtBQUNBLGVBQUEsSUFBQSxrQkFBQTtBQUNBLGVBQUEsSUFBQSxxQkFBQTtBQUNBLGVBQUEsSUFBQSxtQkFBQSx3L0RBQUEsT0FBQSxTQUFBIiwiZmlsZSI6Im1haW4tMTU4NzY1MzYzNTQ4NC5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJhbmd1bGFyXG4gICAgLm1vZHVsZSgncm9vdCcsIFtcbiAgICAgICAgJ2NvbW1vbicsXG4gICAgICAgICdjb21wb25lbnRzJyxcbiAgICAgICAgJ3RlbXBsYXRlcycsXG4gICAgICAgICduZ01hdGVyaWFsJ1xuICAgIF0pOyIsImFuZ3VsYXIgXG4gICAgLm1vZHVsZSgnY29tcG9uZW50cycsIFxuICAgIFsnY29tcG9uZW50cy5ob21lJyxcbiAgICAnY29tcG9uZW50cy5zZW1lc3RlcnMnLFxuICAgICdjb21wb25lbnRzLmFkZGNsYXNzJyxcbiAgICAnbmdNYXRlcmlhbCdcbl0pOyAiLCJhbmd1bGFyXG4gIC5tb2R1bGUoJ2NvbW1vbicsIFtcbiAgICAndWkucm91dGVyJyxcbiAgICAnbmdNYXRlcmlhbCcsXG4gICAgJ25nUGFyc2UnLFxuICBdKVxuICAucnVuKGZ1bmN0aW9uICgpIHtcbiAgICBjb25zb2xlLmxvZyhcImNvbW1vbiBtb2R1bGVcIilcbiAgfSk7IiwiYW5ndWxhclxuICAgIC5tb2R1bGUoJ2NvbXBvbmVudHMuYWRkY2xhc3MnLCBbXG4gICAgICAgICd1aS5yb3V0ZXInLFxuICAgICAgICAnbmdNYXRlcmlhbCdcbiAgICAgICAgXG4gICAgXSk7IiwiYW5ndWxhclxuICAgIC5tb2R1bGUoJ2NvbXBvbmVudHMuaG9tZScsIFtcbiAgICAgICAgJ3VpLnJvdXRlcicsXG4gICAgICAgICduZ01hdGVyaWFsJ1xuICAgICAgICBcbiAgICBdKTsiLCJhbmd1bGFyXG4gICAgLm1vZHVsZSgnY29tcG9uZW50cy5zZW1lc3RlcnMnLCBbXG4gICAgICAgICd1aS5yb3V0ZXInLFxuICAgICAgICAnbmdNYXRlcmlhbCcsXG4gICAgICAgICd1aS5zb3J0YWJsZSdcbiAgICAgICAgXG4gICAgXSk7IiwidmFyIHJvb3QgPSB7XG4gICAgdGVtcGxhdGVVcmw6ICcuL3Jvb3QuaHRtbCdcbiAgfTtcbiAgXG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKCdyb290JylcbiAgICAuY29tcG9uZW50KCdyb290Jywgcm9vdCk7XG5cblxuXG4iLCJ2YXIgYXBwTmF2ID0ge1xuICAgIHRlbXBsYXRlVXJsOiAnLi9hcHAtbmF2Lmh0bWwnXG4gIH07XG4gIFxuICBhbmd1bGFyXG4gICAgLm1vZHVsZSgnY29tbW9uJylcbiAgICAuY29tcG9uZW50KCdhcHBOYXYnLCBhcHBOYXYpOyIsInZhciBhcHAgPSB7XG4gICAgdGVtcGxhdGVVcmw6ICcuL2FwcC5odG1sJyxcbiAgICBjb250cm9sbGVyOiAnQXBwQ29udHJvbGxlcidcbiAgfTtcbiAgXG4gIGFuZ3VsYXJcbiAgICAubW9kdWxlKCdjb21tb24nKVxuICAgIC5jb21wb25lbnQoJ2FwcCcsIGFwcClcbiAgICAuY29uZmlnKGZ1bmN0aW9uICgkc3RhdGVQcm92aWRlcikge1xuICAgICAgJHN0YXRlUHJvdmlkZXJcbiAgICAgICAgLnN0YXRlKCdhcHAnLCB7XG4gICAgICAgICAgICAgIHJlZGlyZWN0VG86ICBcImhvbWVcIixcbiAgICAgICAgICAgICAgdXJsOiAnLycsXG4gICAgICAgICAgICAgIGNvbXBvbmVudDogJ2FwcCcsXG5cbiAgICAgICAgICAgIH1cbiAgICAgICAgICBcbiAgICAgICAgKVxuICAgIH0pOyIsImZ1bmN0aW9uIGNvbmZpZyhQYXJzZVByb3ZpZGVyKSB7XG4gIFBhcnNlUHJvdmlkZXIuc2VydmVyVVJMID0gJ2h0dHBzOi8vcGFyc2VhcGkuYmFjazRhcHAuY29tJzsgLy8gVGhpcyBpcyB5b3VyIFNlcnZlciBVUkxcbiAgUGFyc2VQcm92aWRlci5pbml0aWFsaXplKFxuICAgICdVWndwRmJHWVBXR0dLc1ZBdDV2UnpQYkgxbFNkWDZ1NzdPRjNLckQ1JywgLy8gVGhpcyBpcyB5b3VyIEFwcGxpY2F0aW9uIElEXG4gICAgJ0lwSzZqeXpkU1NPR2ZxZk01U2JBOTBVbWFrakxDaGZiRWpjYVBGQlMnIC8vIFRoaXMgaXMgeW91ciBKYXZhc2NyaXB0IGtleVxuICApO1xufVxuXG5hbmd1bGFyLm1vZHVsZSgnY29tbW9uJykuY29uZmlnKGNvbmZpZyk7IiwiZnVuY3Rpb24gQXBwQ29udHJvbGxlcigkc3RhdGUpIHtcbiAgICB2YXIgY3RybCA9IHRoaXM7XG4gICAgY29uc29sZS5sb2coXCJhcHAgY29udHJvbGxlclwiKVxuICB9XG4gIFxuICBhbmd1bGFyXG4gICAgLm1vZHVsZSgnY29tbW9uJylcbiAgICAuY29udHJvbGxlcignQXBwQ29udHJvbGxlcicsIEFwcENvbnRyb2xsZXIpOyIsImZ1bmN0aW9uIGluaXQoICR1aVJvdXRlcil7XG4gICAgdmFyIFZpc3VhbGl6ZXIgPSB3aW5kb3dbJ3VpLXJvdXRlci12aXN1YWxpemVyJ10uVmlzdWFsaXplcjtcbiAgICB2YXIgcGx1Z0luc3RhbmNlID0gJHVpUm91dGVyLnBsdWdpbihWaXN1YWxpemVyKTtcbn1cblxuYW5ndWxhci5tb2R1bGUoJ2NvbW1vbicpLnJ1bihpbml0KSIsInZhciBhZGRjbGFzcyA9IHtcbiAgICB0ZW1wbGF0ZVVybDogJy4vYWRkY2xhc3MuaHRtbCcsXG4gICAgY29udHJvbGxlcjogJ0FkZENsYXNzQ29udHJvbGxlcicsXG5cbn1cblxuYW5ndWxhclxuICAgIC5tb2R1bGUoJ2NvbXBvbmVudHMuYWRkY2xhc3MnKVxuICAgIC5jb21wb25lbnQoJ2FkZGNsYXNzJywgYWRkY2xhc3MpXG4gICAgLmNvbmZpZyhmdW5jdGlvbiAoJHN0YXRlUHJvdmlkZXIpIHtcbiAgICAgICAgJHN0YXRlUHJvdmlkZXIuc3RhdGUoJ2FkZGNsYXNzJywge1xuICAgICAgICAgICAgcGFyZW50OiAnYXBwJyxcbiAgICAgICAgICAgIHVybDogJ2FkZGNsYXNzJyxcbiAgICAgICAgICAgIGNvbXBvbmVudDogJ2FkZGNsYXNzJ1xuICAgICAgICB9KVxuICAgIH0pXG5cbiAgICAiLCJmdW5jdGlvbiBBZGRDbGFzc0NvbnRyb2xsZXIoJHN0YXRlLCAkbWREaWFsb2csICRodHRwLCBKU09OU2VydmljZSwgQ291cnNlTW9kZWwpIHtcbiAgICB2YXIgY3RybCA9IHRoaXM7XG5cbiAgICAvLyBKU09OU2VydmljZS5nZXRDbGFzc0RhdGEoKS50aGVuKChKU09OZGF0YSkgPT4ge1xuICAgIC8vICAgLy8gYWxsIG9mIHRoZSBqc29uIGRhdGFcbiAgICAvLyAgIGN0cmwuY2xhc3NEYXRhID0gSlNPTmRhdGE7XG4gICAgICBcbiAgICAvLyAgIGNvbnNvbGUubG9nKCdBbGwgQ2xhc3MgRGF0YTonLCBKU09OZGF0YSlcbiAgICAvLyAgIGNvbnNvbGUubG9nKEpTT05kYXRhLmRhdGEubWFqb3JbMF0pXG4gICAgLy8gICBjb25zb2xlLmxvZyhcImFkZCBjbGFzcyBjb250cm9sbGVyXCIpXG5cbiAgICAvLyAgIC8vIGdldCBhbGwgdGhlIG1ham9ycyBpbiB0aGUgYWRkQ2xhc3MuanNvbiBcbiAgICAvLyAgIGN0cmwuanNvbm1ham9ycyA9IEpTT05kYXRhLmRhdGEubWFqb3JbMF1cbiAgICAvLyAgIGN0cmwubWFqb3JzID0gW11cbiAgICAvLyAgIGFuZ3VsYXIuZm9yRWFjaChjdHJsLmpzb25tYWpvcnMsIGZ1bmN0aW9uICh2YWx1ZSwga2V5KSB7XG4gICAgLy8gICAgIGN0cmwubWFqb3JzLnB1c2goa2V5KVxuICAgIC8vICAgfSlcblxuICAgIC8vICAgLy8gZ28gdGhyb3VnaCBlYWNoIG9mIHRoZSBjbGFzc2VzIG9mIHRoZSBtYWpvciB0byBnZXQgdGhlIG5hbWVcbiAgICAvLyAgIGN0cmwuYWxsQ2xhc3NlcyA9IFtdXG4gICAgLy8gICBhbmd1bGFyLmZvckVhY2goY3RybC5tYWpvcnMsIGZ1bmN0aW9uIChrZXkpIHtcbiAgICAvLyAgICAgYW5ndWxhci5mb3JFYWNoKGN0cmwuanNvbm1ham9yc1trZXldWydjb3Vyc2VzJ11bMF0sIGZ1bmN0aW9uKGtleSkge1xuICAgIC8vICAgICAgIGN0cmwuYWxsQ2xhc3Nlcy5wdXNoKGtleSlcbiAgICAvLyAgICAgfSlcbiAgICAvLyAgIH0pXG5cbiAgICBjdHJsLmFsbENsYXNzZXMgPSBbXVxuICAgIENvdXJzZU1vZGVsLmdldENvdXJzZXMoKS50aGVuKGZ1bmN0aW9uKGNvdXJzZXMpIHtcbiAgICAgIGNvbnNvbGUubG9nKCdjb3Vyc2VzOiAnLCBjb3Vyc2VzKTsgXG4gICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvdXJzZXMubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgaWYgKGNvdXJzZXNbaV0uYXR0cmlidXRlcy5zZW1lc3RlckRlZmF1bHQgPT0gbnVsbCkge1xuICAgICAgICAgIGN0cmwuYWxsQ2xhc3Nlcy5wdXNoKGNvdXJzZXNbaV0pXG4gICAgICAgICAgY29uc29sZS5sb2coY291cnNlc1tpXS5hdHRyaWJ1dGVzLmNvdXJzZU5hbWUpXG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGNvbnNvbGUubG9nKCdjb3Vyc2VzIGxpc3RlZC4uLicsIGN0cmwuYWxsQ2xhc3NlcylcbiAgICB9KS5jYXRjaChmdW5jdGlvbigpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiY291bGRuJ3QgZmV0Y2ggY291cnNlc1wiKVxuICAgIH0pXG5cbiAgICAgIGNvbnNvbGUubG9nKCdjb3Vyc2VzIGxpc3RlZC4uLicsIGN0cmwuYWxsQ2xhc3NlcylcblxuICAgICAgLy8gZ28gdGhyb3VnaCBlYWNoIG9mIHRoZSBjbGFzc2VzIHRvIGdldCB0aGUgZGVzY3JpcHRpb24gb2YgdGhlIGNsYXNzXG4gICAgICBjdHJsLmRvU2Vjb25kYXJ5QWN0aW9uID0gZnVuY3Rpb24oZXZlbnQsIGRlc2NyaXB0aW9uKSB7XG4gICAgICAgICAgJG1kRGlhbG9nLnNob3coXG4gICAgICAgICAgICAkbWREaWFsb2cuYWxlcnQoKVxuICAgICAgICAgICAgICAudGl0bGUoXCJDb3Vyc2UgRGVzY3JpcHRpb25cIilcbiAgICAgICAgICAgICAgLnRleHRDb250ZW50KGRlc2NyaXB0aW9uKVxuICAgICAgICAgICAgICAub2soJ09rJylcbiAgICAgICAgICAgICAgLnRhcmdldEV2ZW50KGV2ZW50KVxuICAgICAgICAgICk7XG4gICAgICB9O1xuXG4gICAgICBjdHJsLmFkZENvdXJzZVRvU2VtZXN0ZXIgPSBmdW5jdGlvbihldmVudCwgY291cnNlKSB7XG4gICAgICAgIENvdXJzZU1vZGVsLmdldEJ5TmFtZShjb3Vyc2UpLnRoZW4oZnVuY3Rpb24oY291cnNlKSB7XG4gICAgICAgICAgY29uc29sZS5sb2coJ2NvdXJzZSBmb3VuZC4gaWQ6ICcsIGNvdXJzZS5pZCk7XG4gICAgICAgICAgY29uc29sZS5sb2coJ3NlbmRpbmcgaWQgdG8gc2V0U2VtZXN0ZXJEZWZhdWx0JylcbiAgICAgICAgICBDb3Vyc2VNb2RlbC5zZXRTZW1lc3RlckRlZmF1bHQoY291cnNlLmlkLCAzKS50aGVuKGZ1bmN0aW9uKHN1Y2Nlc3MpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdzZXQgbmV3IGRlZmF1bHQnKVxuICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdmYWlsZWQgdG8gc2V0IG5ldyBkZWZhdWx0LicpOyBcbiAgICAgICAgICB9KVxuICAgICAgICB9KS5jYXRjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICBjb25zb2xlLmxvZyhcImNvdWxkIG5vdCBmaW5kIGNvdXJzZVwiKVxuICAgICAgICB9KVxuICAgICAgfVxuXG5cbiAgfVxuICBcbmFuZ3VsYXJcbiAgICAubW9kdWxlKCdjb21wb25lbnRzLmFkZGNsYXNzJylcbiAgICAuY29udHJvbGxlcignQWRkQ2xhc3NDb250cm9sbGVyJywgQWRkQ2xhc3NDb250cm9sbGVyKTsiLCIvKiBkZWZpbmVzIHRoZSBob21lIGNvbXBvbmVudCwgdGhlIGZpcnN0IHBhZ2UgdGhlIHVzZXIgc2VlcyAqL1xudmFyIGhvbWUgPSB7XG4gICAgdGVtcGxhdGVVcmw6ICcuL2hvbWUuaHRtbCcsXG4gICAgY29udHJvbGxlcjogJ0hvbWVDb250cm9sbGVyJyxcblxufVxuXG5hbmd1bGFyXG4gICAgLm1vZHVsZSgnY29tcG9uZW50cy5ob21lJylcbiAgICAuY29tcG9uZW50KCdob21lJywgaG9tZSlcbiAgICAuY29uZmlnKGZ1bmN0aW9uICgkc3RhdGVQcm92aWRlciwgJHVybFJvdXRlclByb3ZpZGVyKSB7XG4gICAgICAgICRzdGF0ZVByb3ZpZGVyLnN0YXRlKCdob21lJywge1xuICAgICAgICAgICAgcGFyZW50OiAnYXBwJyxcbiAgICAgICAgICAgIHVybDogJ2hvbWUnLFxuICAgICAgICAgICAgY29tcG9uZW50OiAnaG9tZSdcbiAgICAgICAgfSlcbiAgICAkdXJsUm91dGVyUHJvdmlkZXIub3RoZXJ3aXNlKCcvJyk7XG4gICAgfSk7IFxuXG4gICAgIiwiLy8gZGlzcGxheSB0aGUgbWFqb3Igb3B0aW9ucyBpbiB0aGUgZHJvcGRvd24gb2YgaG9tZVxuZnVuY3Rpb24gSG9tZUNvbnRyb2xsZXIoJHN0YXRlLCBNYWpvck1vZGVsKSB7XG4vL2Z1bmN0aW9uIEhvbWVDb250cm9sbGVyKCRzdGF0ZSkge1xuICAgIHZhciBjdHJsID0gdGhpcztcbiAgICAgIHRoaXMuJG9uSW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiaG9tZSBjb250cm9sbGVyXCIpXG4gICAgICAvLyBjdHJsLm1ham9ycyA9IFsnQ29tcHV0ZXIgU2NpZW5jZScsICdDb21wdXRlciBFbmdpbmVlcmluZyddXG4gICAgICBsZXQgbWFqb3JzX2xpc3QgPSBbXVxuICAgICAgTWFqb3JNb2RlbC5nZXRNYWpvcnMoKS50aGVuKGZ1bmN0aW9uKG1ham9ycykge1xuICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IG1ham9ycy5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIG1ham9yc19saXN0LnB1c2gobWFqb3JzW2ldLmF0dHJpYnV0ZXMubWFqb3JOYW1lKVxuICAgICAgICB9XG4gICAgICAgIGN0cmwubWFqb3JzID0gbWFqb3JzX2xpc3Q7XG4gICAgICB9KVxuICAgICAgLy9jb25zb2xlLmxvZyhNYWpvck1vZGVsLmdldEJ5SWQoJzFaQ2N2Z284TjYnKSlcbiAgICB9XG4gIH1cblxuXG5hbmd1bGFyXG4gICAgLm1vZHVsZSgnY29tcG9uZW50cy5ob21lJylcbiAgICAuY29udHJvbGxlcignSG9tZUNvbnRyb2xsZXInLCBIb21lQ29udHJvbGxlcik7IiwidmFyIHNlbWVzdGVycyA9IHtcbiAgICB0ZW1wbGF0ZVVybDogJy4vc2VtZXN0ZXJzLmh0bWwnLFxuICAgIGNvbnRyb2xsZXI6ICdTZW1lc3RlcnNDb250cm9sbGVyJyxcblxufVxuXG5hbmd1bGFyXG4gICAgLm1vZHVsZSgnY29tcG9uZW50cy5zZW1lc3RlcnMnKVxuICAgIC5jb21wb25lbnQoJ3NlbWVzdGVycycsIHNlbWVzdGVycylcbiAgICAuY29uZmlnKGZ1bmN0aW9uICgkc3RhdGVQcm92aWRlcikge1xuICAgICAgICAkc3RhdGVQcm92aWRlci5zdGF0ZSgnc2VtZXN0ZXJzJywge1xuICAgICAgICAgICAgcGFyZW50OiAnYXBwJyxcbiAgICAgICAgICAgIHVybDogJ3NlbWVzdGVycycsXG4gICAgICAgICAgICBjb21wb25lbnQ6ICdzZW1lc3RlcnMnXG4gICAgICAgIH0pXG4gICAgfSlcblxuICAgICIsImZ1bmN0aW9uIFNlbWVzdGVyc0NvbnRyb2xsZXIoJGh0dHAsICRtZERpYWxvZywgSlNPTlNlcnZpY2UsIENvdXJzZU1vZGVsLCAkd2luZG93KSB7XG4gICAgdmFyIGN0cmwgPSB0aGlzO1xuICAgIGNvbnNvbGUubG9nKFwic2VtZXN0ZXJzIGNvbnRyb2xsZXJcIilcblxuICAgIGZ1bmN0aW9uIHBvcHVsYXRlTGlzdHMoQ291cnNlTW9kZWwpIHtcbiAgICAgICAgY3RybC5tb2RlbHMgPSB7XG4gICAgICAgICAgICBzZWxlY3RlZDogbnVsbCxcbiAgICAgICAgICAgIHNlbWVzdGVyczoge1xuICAgICAgICAgICAgICAgIDE6IFtdLFxuICAgICAgICAgICAgICAgIDI6IFtdLFxuICAgICAgICAgICAgICAgIDM6IFtdLFxuICAgICAgICAgICAgICAgIDQ6IFtdLFxuICAgICAgICAgICAgICAgIDU6IFtdLFxuICAgICAgICAgICAgICAgIDY6IFtdLFxuICAgICAgICAgICAgICAgIDc6IFtdLFxuICAgICAgICAgICAgICAgIDg6IFtdXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcHJlcmVxczoge30sIC8vIHdpbGwgYmUga2V5IHZhbHVlIHBhaXIgb2YgY2xhc3MgbmFtZSBhbmQgcHJlcmVxcyBsaXN0IFxuICAgICAgICAgICAgbmFtZXM6IHt9LFxuICAgICAgICAgICAgY3JlZGl0czoge30sXG4gICAgICAgICAgICBjcmVkaXRUb3RhbDogWzAsIDAsIDAsIDAsIDAsIDAsIDAsIDBdLFxuICAgICAgICAgICAgY29uZmxpY3RpbmdDbGFzc2VzOiBbXVxuICAgICAgICB9O1xuICAgICAgICAvLyBzZW0gMSBcbiAgICAgICAgY29uc29sZS5sb2coXCJwb3B1bGF0aW5nIGxpc3RzXCIpXG4gICAgICAgIHZhciBjb3Vyc2VzID0gIENvdXJzZU1vZGVsLmdldENvdXJzZUJ5U2VtKDEpLnRoZW4oZnVuY3Rpb24oY291cnNlcykge1xuICAgICAgICAgICAgZm9yICh2YXIgaWR4PTA7IGlkeDxjb3Vyc2VzLmxlbmd0aDsgaWR4KyspIHtcbiAgICAgICAgICAgICAgICB2YXIgY2xhc3NOYW1lID0gY291cnNlc1tpZHhdLmF0dHJpYnV0ZXMuY291cnNlTmFtZTsgICAvLyBpZSBcIkNhbGN1bHVzIElJXCIgXG4gICAgICAgICAgICAgICAgY3RybC5tb2RlbHMuc2VtZXN0ZXJzWzFdLnB1c2goY2xhc3NOYW1lKTtcbiAgICAgICAgICAgICAgICBjdHJsLm1vZGVscy5wcmVyZXFzW2NsYXNzTmFtZV0gPSBjb3Vyc2VzW2lkeF0uYXR0cmlidXRlcy5wcmVyZXF1aXNpdGVzOyAgICAgLy8gaWUgW1wiTUFUSCAxMDU1MFwiXVxuICAgICAgICAgICAgICAgIGN0cmwubW9kZWxzLm5hbWVzW2NsYXNzTmFtZV0gPSBjb3Vyc2VzW2lkeF0uYXR0cmlidXRlcy5jb3Vyc2VJZDsgICAgICAgICAgICAvLyBpZSBcIk1BVEggMTA1NjBcIlxuICAgICAgICAgICAgICAgIGN0cmwubW9kZWxzLmNyZWRpdHNbY2xhc3NOYW1lXSA9IGNvdXJzZXNbaWR4XS5hdHRyaWJ1dGVzLmNyZWRpdHM7ICAgICAgICAgICAvLyBpZSAzXG4gICAgICAgICAgICAgICAgY3RybC5tb2RlbHMuY3JlZGl0VG90YWxbMF0gKz0gY291cnNlc1tpZHhdLmF0dHJpYnV0ZXMuY3JlZGl0cztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSlcblxuICAgICAgICAvLyBzZW0gMiBcbiAgICAgICAgY291cnNlcyA9ICBDb3Vyc2VNb2RlbC5nZXRDb3Vyc2VCeVNlbSgyKS50aGVuKGZ1bmN0aW9uKGNvdXJzZXMpIHtcbiAgICAgICAgICAgIGZvciAodmFyIGlkeD0wOyBpZHg8Y291cnNlcy5sZW5ndGg7IGlkeCsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIGNsYXNzTmFtZSA9IGNvdXJzZXNbaWR4XS5hdHRyaWJ1dGVzLmNvdXJzZU5hbWU7ICAgLy8gaWUgXCJDYWxjdWx1cyBJSVwiIFxuICAgICAgICAgICAgICAgIGN0cmwubW9kZWxzLnNlbWVzdGVyc1syXS5wdXNoKGNsYXNzTmFtZSk7XG4gICAgICAgICAgICAgICAgY3RybC5tb2RlbHMucHJlcmVxc1tjbGFzc05hbWVdID0gY291cnNlc1tpZHhdLmF0dHJpYnV0ZXMucHJlcmVxdWlzaXRlczsgICAgIC8vIGllIFtcIk1BVEggMTA1NTBcIl1cbiAgICAgICAgICAgICAgICBjdHJsLm1vZGVscy5uYW1lc1tjbGFzc05hbWVdID0gY291cnNlc1tpZHhdLmF0dHJpYnV0ZXMuY291cnNlSWQ7ICAgICAgICAgICAgLy8gaWUgXCJNQVRIIDEwNTYwXCJcbiAgICAgICAgICAgICAgICBjdHJsLm1vZGVscy5jcmVkaXRzW2NsYXNzTmFtZV0gPSBjb3Vyc2VzW2lkeF0uYXR0cmlidXRlcy5jcmVkaXRzOyAgICAgICAgICAgLy8gaWUgM1xuICAgICAgICAgICAgICAgIGN0cmwubW9kZWxzLmNyZWRpdFRvdGFsWzFdICs9IGNvdXJzZXNbaWR4XS5hdHRyaWJ1dGVzLmNyZWRpdHM7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pXG5cbiAgICAgICAgLy8gc2VtIDMgXG4gICAgICAgIGNvdXJzZXMgPSAgQ291cnNlTW9kZWwuZ2V0Q291cnNlQnlTZW0oMykudGhlbihmdW5jdGlvbihjb3Vyc2VzKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpZHg9MDsgaWR4PGNvdXJzZXMubGVuZ3RoOyBpZHgrKykge1xuICAgICAgICAgICAgICAgIHZhciBjbGFzc05hbWUgPSBjb3Vyc2VzW2lkeF0uYXR0cmlidXRlcy5jb3Vyc2VOYW1lOyAgIC8vIGllIFwiQ2FsY3VsdXMgSUlcIiBcbiAgICAgICAgICAgICAgICBjdHJsLm1vZGVscy5zZW1lc3RlcnNbM10ucHVzaChjbGFzc05hbWUpO1xuICAgICAgICAgICAgICAgIGN0cmwubW9kZWxzLnByZXJlcXNbY2xhc3NOYW1lXSA9IGNvdXJzZXNbaWR4XS5hdHRyaWJ1dGVzLnByZXJlcXVpc2l0ZXM7ICAgICAvLyBpZSBbXCJNQVRIIDEwNTUwXCJdXG4gICAgICAgICAgICAgICAgY3RybC5tb2RlbHMubmFtZXNbY2xhc3NOYW1lXSA9IGNvdXJzZXNbaWR4XS5hdHRyaWJ1dGVzLmNvdXJzZUlkOyAgICAgICAgICAgIC8vIGllIFwiTUFUSCAxMDU2MFwiXG4gICAgICAgICAgICAgICAgY3RybC5tb2RlbHMuY3JlZGl0c1tjbGFzc05hbWVdID0gY291cnNlc1tpZHhdLmF0dHJpYnV0ZXMuY3JlZGl0czsgICAgICAgICAgIC8vIGllIDNcbiAgICAgICAgICAgICAgICBjdHJsLm1vZGVscy5jcmVkaXRUb3RhbFsyXSArPSBjb3Vyc2VzW2lkeF0uYXR0cmlidXRlcy5jcmVkaXRzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuXG4gICAgICAgIC8vIHNlbSA0XG4gICAgICAgIGNvdXJzZXMgPSAgQ291cnNlTW9kZWwuZ2V0Q291cnNlQnlTZW0oNCkudGhlbihmdW5jdGlvbihjb3Vyc2VzKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpZHg9MDsgaWR4PGNvdXJzZXMubGVuZ3RoOyBpZHgrKykge1xuICAgICAgICAgICAgICAgIHZhciBjbGFzc05hbWUgPSBjb3Vyc2VzW2lkeF0uYXR0cmlidXRlcy5jb3Vyc2VOYW1lOyAgIC8vIGllIFwiQ2FsY3VsdXMgSUlcIiBcbiAgICAgICAgICAgICAgICBjdHJsLm1vZGVscy5zZW1lc3RlcnNbNF0ucHVzaChjbGFzc05hbWUpO1xuICAgICAgICAgICAgICAgIGN0cmwubW9kZWxzLnByZXJlcXNbY2xhc3NOYW1lXSA9IGNvdXJzZXNbaWR4XS5hdHRyaWJ1dGVzLnByZXJlcXVpc2l0ZXM7ICAgICAvLyBpZSBbXCJNQVRIIDEwNTUwXCJdXG4gICAgICAgICAgICAgICAgY3RybC5tb2RlbHMubmFtZXNbY2xhc3NOYW1lXSA9IGNvdXJzZXNbaWR4XS5hdHRyaWJ1dGVzLmNvdXJzZUlkOyAgICAgICAgICAgIC8vIGllIFwiTUFUSCAxMDU2MFwiXG4gICAgICAgICAgICAgICAgY3RybC5tb2RlbHMuY3JlZGl0c1tjbGFzc05hbWVdID0gY291cnNlc1tpZHhdLmF0dHJpYnV0ZXMuY3JlZGl0czsgICAgICAgICAgIC8vIGllIDNcbiAgICAgICAgICAgICAgICBjdHJsLm1vZGVscy5jcmVkaXRUb3RhbFszXSArPSBjb3Vyc2VzW2lkeF0uYXR0cmlidXRlcy5jcmVkaXRzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuXG4gICAgICAgIC8vIHNlbSA1XG4gICAgICAgIGNvdXJzZXMgPSAgQ291cnNlTW9kZWwuZ2V0Q291cnNlQnlTZW0oNSkudGhlbihmdW5jdGlvbihjb3Vyc2VzKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpZHg9MDsgaWR4PGNvdXJzZXMubGVuZ3RoOyBpZHgrKykge1xuICAgICAgICAgICAgICAgIHZhciBjbGFzc05hbWUgPSBjb3Vyc2VzW2lkeF0uYXR0cmlidXRlcy5jb3Vyc2VOYW1lOyAgIC8vIGllIFwiQ2FsY3VsdXMgSUlcIiBcbiAgICAgICAgICAgICAgICBjdHJsLm1vZGVscy5zZW1lc3RlcnNbNV0ucHVzaChjbGFzc05hbWUpO1xuICAgICAgICAgICAgICAgIGN0cmwubW9kZWxzLnByZXJlcXNbY2xhc3NOYW1lXSA9IGNvdXJzZXNbaWR4XS5hdHRyaWJ1dGVzLnByZXJlcXVpc2l0ZXM7ICAgICAvLyBpZSBbXCJNQVRIIDEwNTUwXCJdXG4gICAgICAgICAgICAgICAgY3RybC5tb2RlbHMubmFtZXNbY2xhc3NOYW1lXSA9IGNvdXJzZXNbaWR4XS5hdHRyaWJ1dGVzLmNvdXJzZUlkOyAgICAgICAgICAgIC8vIGllIFwiTUFUSCAxMDU2MFwiXG4gICAgICAgICAgICAgICAgY3RybC5tb2RlbHMuY3JlZGl0c1tjbGFzc05hbWVdID0gY291cnNlc1tpZHhdLmF0dHJpYnV0ZXMuY3JlZGl0czsgICAgICAgICAgIC8vIGllIDNcbiAgICAgICAgICAgICAgICBjdHJsLm1vZGVscy5jcmVkaXRUb3RhbFs0XSArPSBjb3Vyc2VzW2lkeF0uYXR0cmlidXRlcy5jcmVkaXRzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuXG4gICAgICAgIC8vIHNlbSA2XG4gICAgICAgIGNvdXJzZXMgPSAgQ291cnNlTW9kZWwuZ2V0Q291cnNlQnlTZW0oNikudGhlbihmdW5jdGlvbihjb3Vyc2VzKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpZHg9MDsgaWR4PGNvdXJzZXMubGVuZ3RoOyBpZHgrKykge1xuICAgICAgICAgICAgICAgIHZhciBjbGFzc05hbWUgPSBjb3Vyc2VzW2lkeF0uYXR0cmlidXRlcy5jb3Vyc2VOYW1lOyAgIC8vIGllIFwiQ2FsY3VsdXMgSUlcIiBcbiAgICAgICAgICAgICAgICBjdHJsLm1vZGVscy5zZW1lc3RlcnNbNl0ucHVzaChjbGFzc05hbWUpO1xuICAgICAgICAgICAgICAgIGN0cmwubW9kZWxzLnByZXJlcXNbY2xhc3NOYW1lXSA9IGNvdXJzZXNbaWR4XS5hdHRyaWJ1dGVzLnByZXJlcXVpc2l0ZXM7ICAgICAvLyBpZSBbXCJNQVRIIDEwNTUwXCJdXG4gICAgICAgICAgICAgICAgY3RybC5tb2RlbHMubmFtZXNbY2xhc3NOYW1lXSA9IGNvdXJzZXNbaWR4XS5hdHRyaWJ1dGVzLmNvdXJzZUlkOyAgICAgICAgICAgIC8vIGllIFwiTUFUSCAxMDU2MFwiXG4gICAgICAgICAgICAgICAgY3RybC5tb2RlbHMuY3JlZGl0c1tjbGFzc05hbWVdID0gY291cnNlc1tpZHhdLmF0dHJpYnV0ZXMuY3JlZGl0czsgICAgICAgICAgIC8vIGllIDNcbiAgICAgICAgICAgICAgICBjdHJsLm1vZGVscy5jcmVkaXRUb3RhbFs1XSArPSBjb3Vyc2VzW2lkeF0uYXR0cmlidXRlcy5jcmVkaXRzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuXG4gICAgICAgIC8vIHNlbSA3XG4gICAgICAgIGNvdXJzZXMgPSAgQ291cnNlTW9kZWwuZ2V0Q291cnNlQnlTZW0oNykudGhlbihmdW5jdGlvbihjb3Vyc2VzKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpZHg9MDsgaWR4PGNvdXJzZXMubGVuZ3RoOyBpZHgrKykge1xuICAgICAgICAgICAgICAgIHZhciBjbGFzc05hbWUgPSBjb3Vyc2VzW2lkeF0uYXR0cmlidXRlcy5jb3Vyc2VOYW1lOyAgIC8vIGllIFwiQ2FsY3VsdXMgSUlcIiBcbiAgICAgICAgICAgICAgICBjdHJsLm1vZGVscy5zZW1lc3RlcnNbN10ucHVzaChjbGFzc05hbWUpO1xuICAgICAgICAgICAgICAgIGN0cmwubW9kZWxzLnByZXJlcXNbY2xhc3NOYW1lXSA9IGNvdXJzZXNbaWR4XS5hdHRyaWJ1dGVzLnByZXJlcXVpc2l0ZXM7ICAgICAvLyBpZSBbXCJNQVRIIDEwNTUwXCJdXG4gICAgICAgICAgICAgICAgY3RybC5tb2RlbHMubmFtZXNbY2xhc3NOYW1lXSA9IGNvdXJzZXNbaWR4XS5hdHRyaWJ1dGVzLmNvdXJzZUlkOyAgICAgICAgICAgIC8vIGllIFwiTUFUSCAxMDU2MFwiXG4gICAgICAgICAgICAgICAgY3RybC5tb2RlbHMuY3JlZGl0c1tjbGFzc05hbWVdID0gY291cnNlc1tpZHhdLmF0dHJpYnV0ZXMuY3JlZGl0czsgICAgICAgICAgIC8vIGllIDNcbiAgICAgICAgICAgICAgICBjdHJsLm1vZGVscy5jcmVkaXRUb3RhbFs2XSArPSBjb3Vyc2VzW2lkeF0uYXR0cmlidXRlcy5jcmVkaXRzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuXG4gICAgICAgIC8vIHNlbSA4XG4gICAgICAgIGNvdXJzZXMgPSAgQ291cnNlTW9kZWwuZ2V0Q291cnNlQnlTZW0oOCkudGhlbihmdW5jdGlvbihjb3Vyc2VzKSB7XG4gICAgICAgICAgICBmb3IgKHZhciBpZHg9MDsgaWR4PGNvdXJzZXMubGVuZ3RoOyBpZHgrKykge1xuICAgICAgICAgICAgICAgIHZhciBjbGFzc05hbWUgPSBjb3Vyc2VzW2lkeF0uYXR0cmlidXRlcy5jb3Vyc2VOYW1lOyAgIC8vIGllIFwiQ2FsY3VsdXMgSUlcIiBcbiAgICAgICAgICAgICAgICBjdHJsLm1vZGVscy5zZW1lc3RlcnNbOF0ucHVzaChjbGFzc05hbWUpO1xuICAgICAgICAgICAgICAgIGN0cmwubW9kZWxzLnByZXJlcXNbY2xhc3NOYW1lXSA9IGNvdXJzZXNbaWR4XS5hdHRyaWJ1dGVzLnByZXJlcXVpc2l0ZXM7ICAgICAvLyBpZSBbXCJNQVRIIDEwNTUwXCJdXG4gICAgICAgICAgICAgICAgY3RybC5tb2RlbHMubmFtZXNbY2xhc3NOYW1lXSA9IGNvdXJzZXNbaWR4XS5hdHRyaWJ1dGVzLmNvdXJzZUlkOyAgICAgICAgICAgIC8vIGllIFwiTUFUSCAxMDU2MFwiXG4gICAgICAgICAgICAgICAgY3RybC5tb2RlbHMuY3JlZGl0c1tjbGFzc05hbWVdID0gY291cnNlc1tpZHhdLmF0dHJpYnV0ZXMuY3JlZGl0czsgICAgICAgICAgIC8vIGllIDNcbiAgICAgICAgICAgICAgICBjdHJsLm1vZGVscy5jcmVkaXRUb3RhbFs3XSArPSBjb3Vyc2VzW2lkeF0uYXR0cmlidXRlcy5jcmVkaXRzO1xuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuXG4gICAgfVxuXG4gICAgZnVuY3Rpb24gY2FsY3VsYXRlQ3JlZGl0VG90YWxzUHJlcmVxcygpIHtcbiAgICAgICAgYW5ndWxhci5mb3JFYWNoKGN0cmwubW9kZWxzLnNlbWVzdGVycywgZnVuY3Rpb24gKHZhbHVlLCBrZXkpIHtcbiAgICAgICAgICAgIGZvciAobGV0IGk9MDsgaTx2YWx1ZS5sZW5ndGg7IGkrKykge1xuICAgICAgICAgICAgICAgIGN0cmwubW9kZWxzLmNyZWRpdFRvdGFsW2tleS0xXSArPSBjdHJsLm1vZGVscy5jcmVkaXRzW2N0cmwubW9kZWxzLnNlbWVzdGVyc1trZXldW2ldXVxuICAgICAgICAgICAgfVxuICAgICAgICB9KVxuXG5cbiAgICAgICAgLy8gQ29ubmVjdHMgc2VtZXN0ZXIgbGlzdHMgZm9yIGRyYXAgYW5kIGRyb3BcbiAgICAgICAgY3RybC5jbGFzc1dhcm5pbmcgPSBmYWxzZVxuXG4gICAgICAgIGN0cmwuY291cnNlTWFwID0ge1xuICAgICAgICAgICAgc3RvcDogZnVuY3Rpb24gKGUsIHVpKSB7XG4gICAgICAgICAgICAgICAgLy9yZXNldCBjcmVkaXRUb3RhbHNcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImNhbGN1bGF0aW5nIGNyZWRpdHNcIilcbiAgICAgICAgICAgICAgICBjdHJsLm1vZGVscy5jcmVkaXRUb3RhbCA9IFswLCAwLCAwLCAwLCAwLCAwLCAwLCAwXVxuICAgICAgICAgICAgICAgIGN0cmwuY2xhc3NXYXJuaW5nID0gZmFsc2VcbiAgICAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKFwiVXBkYXRlZCBDb3Vyc2UgTWFwXCIsIEpTT04uc3RyaW5naWZ5KGN0cmwubW9kZWxzLnNlbWVzdGVycywgdW5kZWZpbmVkLCAyKSlcbiAgICAgICAgICAgICAgICB2YXIgY3VycmVudENsYXNzZXMgPSBbXVxuICAgICAgICAgICAgICAgIC8vIGxvb3AgdGhyb3VnaCBzZW1lc3RlcnNcbiAgICAgICAgICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8IDk7IGkrKykge1xuICAgICAgICAgICAgICAgICAgICBsZW5ndGggPSBjdHJsLm1vZGVscy5zZW1lc3RlcnNbaV0ubGVuZ3RoXG5cbiAgICAgICAgICAgICAgICAgICAgLy8gbG9vcCB0aHJvdWdoIGNsYXNzZXNcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgaiA9IDA7IGogPCBsZW5ndGg7IGorKykge1xuICAgICAgICAgICAgICAgICAgICAgICAgLy8gY2FsY3VsYXRlIG5ldyBjcmVkaXQgdG90YWxzXG4gICAgICAgICAgICAgICAgICAgICAgICBjdHJsLm1vZGVscy5jcmVkaXRUb3RhbFtpIC0gMV0gKz0gY3RybC5tb2RlbHMuY3JlZGl0c1tjdHJsLm1vZGVscy5zZW1lc3RlcnNbaV1bal1dXG5cbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIG1ha2Ugc3VyZSB0aGF0IG1vdmVzIGdldCBzYXZlZCB0byBwYXJzZSAtIHNhdmUgZWFjaCBjbGFzcytzZW1lc3RlclxuICAgICAgICAgICAgICAgICAgICAgICAgQ291cnNlTW9kZWwuZ2V0QnlOYW1lKGN0cmwubW9kZWxzLnNlbWVzdGVyc1tpXVtqXSkudGhlbihmdW5jdGlvbihjb3Vyc2UpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcImNvdXJzZSBiYWNrIGZyb20gZ2V0IGJ5IG5hbWU6IFwiLCBjb3Vyc2UpXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgQ291cnNlTW9kZWwuc2V0U2VtZXN0ZXJEZWZhdWx0KGNvdXJzZS5pZCwgaSkudGhlbihmdW5jdGlvbihzdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJzdWNjZXNzIVwiKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICAgICAgICAgIHZhciBwcmVyZXFzID0gY3RybC5tb2RlbHMucHJlcmVxc1tjdHJsLm1vZGVscy5zZW1lc3RlcnNbaV1bal1dXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAocHJlcmVxcyAhPSBudWxsKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHBsZW5ndGggPSBwcmVyZXFzLmxlbmd0aFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIC8vIGxvb3AgdGhyb3VnaCBwcmVyZXF1aXNpdGVzIFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZvciAobGV0IG0gPSAwOyBtIDwgcGxlbmd0aDsgbSsrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChjdXJyZW50Q2xhc3Nlcy5pbmNsdWRlcyhwcmVyZXFzW21dKSA9PSBmYWxzZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJicmVha2luZyBhIHByZXJlcXVpc2l0aWVzIHJ1bGU6IFwiKSAvLyBpZiBwcmVyZXEgbm90IGluIFwidGFrZW5cIiBjbGFzc2VzXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhwcmVyZXFzW21dKVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3RybC5jbGFzc1dhcm5pbmcgPSB0cnVlXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhjdHJsLmNsYXNzV2FybmluZylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICAgICAgICAgIC8vIGFwcGVuZCBvbiBhbGwgY2xhc3NlcyB5b3UndmUgdGFrZW4gc28gZmFyLCBpbmNsdWRpbmcgdGhpcyBzZW1lc3RlclxuICAgICAgICAgICAgICAgICAgICBmb3IgKGxldCBrID0gMDsgayA8IGxlbmd0aDsgaysrKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICB2YXIgY2xhc3NudW0gPSBjdHJsLm1vZGVscy5uYW1lc1tjdHJsLm1vZGVscy5zZW1lc3RlcnNbaV1ba11dXG4gICAgICAgICAgICAgICAgICAgICAgICBjdXJyZW50Q2xhc3Nlcy5wdXNoKGNsYXNzbnVtKVxuXG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coXCJDcmVkaXRzOiBcIiwgY3RybC5tb2RlbHMuY3JlZGl0VG90YWwpXG4gICAgICAgICAgICB9LFxuICAgICAgICAgICAgcGxhY2Vob2xkZXI6IFwiY291cnNlXCIsXG4gICAgICAgICAgICBjb25uZWN0V2l0aDogXCIuY291cnNlLWxpc3RcIlxuICAgICAgICB9XG4gICAgfVxuXG4gICAgcG9wdWxhdGVMaXN0cyhDb3Vyc2VNb2RlbCk7IFxuICAgIGNhbGN1bGF0ZUNyZWRpdFRvdGFsc1ByZXJlcXMoKTsgXG4gICAgXG4gICAgY3RybC5hZGRDbGFzcyA9IGZ1bmN0aW9uKGV2ZW50LCBzZW1lc3Rlcikge1xuICAgICAgICBjb25zb2xlLmxvZygnc2VtZXN0ZXI6ICcsIHNlbWVzdGVyKVxuICAgICAgICB2YXIgY29uZmlnID0ge1xuICAgICAgICAgICAgcGFyZW50OiBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQuYm9keSksXG4gICAgICAgICAgICBjb250cm9sbGVyOiBBZGRDbGFzc0NvbnRyb2xsZXIsXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICckY3RybCcsXG4gICAgICAgICAgICBkaXNhYmxlUGFyZW50U2Nyb2xsOiB0cnVlLCBcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnLi9hZGRjbGFzcy5odG1sJyxcbiAgICAgICAgICAgIGhhc0JhY2tkcm9wOiB0cnVlLCBcbiAgICAgICAgICAgIHRyYXBGb2N1czogdHJ1ZSwgXG4gICAgICAgICAgICBjbGlja091dHNpZGVUb0Nsb3NlOiB0cnVlLCBcbiAgICAgICAgICAgIGVzY2FwZVRvQ2xvc2U6IHRydWUsIFxuICAgICAgICAgICAgZm9jdXNPbk9wZW46IHRydWUsXG4gICAgICAgICAgICBmdWxsc2NyZWVuOiB0cnVlLCBcbiAgICAgICAgICAgIHRhcmdldEV2ZW50OiBldmVudFxuICAgICAgICB9XG5cbiAgICAgICAgJG1kRGlhbG9nLnNob3coY29uZmlnKVxuICAgICAgICAgICAgLnRoZW4oYW5zd2VyID0+IHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnYW5zd2VyOiAnLCBhbnN3ZXIpOyBcbiAgICAgICAgICAgIH0pXG5cblxuICAgIGZ1bmN0aW9uIEFkZENsYXNzQ29udHJvbGxlcigkc3RhdGUsICRtZERpYWxvZywgJGh0dHAsIEpTT05TZXJ2aWNlLCBDb3Vyc2VNb2RlbCwgJHdpbmRvdykge1xuICAgICAgICB2YXIgY3RybCA9IHRoaXM7XG4gICAgICAgIGNvbnNvbGUubG9nKFwicnVubmluZyBjb250cm9sbGVyXCIpXG4gICAgICAgIGN0cmwuYWxsQ2xhc3NlcyA9IFtdXG4gICAgICAgIENvdXJzZU1vZGVsLmdldENvdXJzZXMoKS50aGVuKGZ1bmN0aW9uKGNvdXJzZXMpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2NvdXJzZXM6ICcsIGNvdXJzZXMpOyBcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb3Vyc2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBpZiAoY291cnNlc1tpXS5hdHRyaWJ1dGVzLnNlbWVzdGVyRGVmYXVsdCA9PSBudWxsKSB7XG4gICAgICAgICAgICBjdHJsLmFsbENsYXNzZXMucHVzaChjb3Vyc2VzW2ldKVxuICAgICAgICAgICAgY29uc29sZS5sb2coY291cnNlc1tpXS5hdHRyaWJ1dGVzLmNvdXJzZU5hbWUpXG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgY29uc29sZS5sb2coJ2NvdXJzZXMgbGlzdGVkLi4uJywgY3RybC5hbGxDbGFzc2VzKVxuICAgICAgICB9KS5jYXRjaChmdW5jdGlvbigpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJjb3VsZG4ndCBmZXRjaCBjb3Vyc2VzXCIpXG4gICAgICAgIH0pXG5cbiAgICAgICAgY29uc29sZS5sb2coJ2NvdXJzZXMgbGlzdGVkLi4uJywgY3RybC5hbGxDbGFzc2VzKVxuXG4gICAgICAgIC8vIGdvIHRocm91Z2ggZWFjaCBvZiB0aGUgY2xhc3NlcyB0byBnZXQgdGhlIGRlc2NyaXB0aW9uIG9mIHRoZSBjbGFzc1xuICAgICAgICBjdHJsLmRvU2Vjb25kYXJ5QWN0aW9uID0gZnVuY3Rpb24oZXZlbnQsIGRlc2NyaXB0aW9uKSB7XG4gICAgICAgICAgICAkbWREaWFsb2cuc2hvdyhcbiAgICAgICAgICAgICAgICAkbWREaWFsb2cuYWxlcnQoKVxuICAgICAgICAgICAgICAgIC50aXRsZShcIkNvdXJzZSBEZXNjcmlwdGlvblwiKVxuICAgICAgICAgICAgICAgIC50ZXh0Q29udGVudChkZXNjcmlwdGlvbilcbiAgICAgICAgICAgICAgICAub2soJ09rJylcbiAgICAgICAgICAgICAgICAudGFyZ2V0RXZlbnQoZXZlbnQpXG4gICAgICAgICAgICApO1xuICAgICAgICB9O1xuXG4gICAgICAgIGN0cmwuYWRkQ291cnNlVG9TZW1lc3RlcldyYXBwZXIgPSBmdW5jdGlvbihldmVudCwgY291cnNlLCAkd2luZG93KSB7XG4gICAgICAgICAgICBhZGRDb3Vyc2VUb1NlbWVzdGVyKGV2ZW50LCBjb3Vyc2UpLnRoZW4oZnVuY3Rpb24oc3VjY2Vzcyl7XG4gICAgICAgICAgICAgICAgJG1kRGlhbG9nLmNhbmNlbCgpOyBcbiAgICAgICAgICAgICAgICAkd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuXG4gICAgICAgIC8vY3RybC5hZGRDb3Vyc2VUb1NlbWVzdGVyID0gZnVuY3Rpb24oZXZlbnQsIGNvdXJzZSkge1xuICAgICAgICBmdW5jdGlvbiBhZGRDb3Vyc2VUb1NlbWVzdGVyKGV2ZW50LCBjb3Vyc2UpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwic3RhcnRpbmc/XCIpXG4gICAgICAgICAgICBDb3Vyc2VNb2RlbC5nZXRCeU5hbWUoY291cnNlKS50aGVuKGZ1bmN0aW9uKGNvdXJzZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2NvdXJzZSBmb3VuZC4gaWQ6ICcsIGNvdXJzZS5pZCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc2VuZGluZyBpZCB0byBzZXRTZW1lc3RlckRlZmF1bHQnKVxuICAgICAgICAgICAgQ291cnNlTW9kZWwuc2V0U2VtZXN0ZXJEZWZhdWx0KGNvdXJzZS5pZCwgcGFyc2VJbnQoc2VtZXN0ZXIpKS50aGVuKGZ1bmN0aW9uKHN1Y2Nlc3MpIHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnc2V0IG5ldyBkZWZhdWx0JylcbiAgICAgICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICAgICAgICAgIHBvcHVsYXRlTGlzdHMoQ291cnNlTW9kZWwpO1xuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZmFpbGVkIHRvIHNldCBuZXcgZGVmYXVsdC4nKTsgXG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIH0pLmNhdGNoKGZ1bmN0aW9uKCkge1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuICAgIH1cbn1cblxuXG4gICAgLy8gZGVsZXRlIGNsYXNzIFwiY29udHJvbGxlclwiXG4gICAgY3RybC5kZWxldGVDbGFzcyA9IGZ1bmN0aW9uKGV2ZW50LCBzZW1lc3Rlcikge1xuICAgICAgICBjb25zb2xlLmxvZygnc2VtZXN0ZXI6ICcsIHNlbWVzdGVyKVxuICAgICAgICB2YXIgY29uZmlnID0ge1xuICAgICAgICAgICAgcGFyZW50OiBhbmd1bGFyLmVsZW1lbnQoZG9jdW1lbnQuYm9keSksXG4gICAgICAgICAgICBjb250cm9sbGVyOiBEZWxldGVDbGFzc0NvbnRyb2xsZXIsXG4gICAgICAgICAgICBjb250cm9sbGVyQXM6ICckY3RybCcsXG4gICAgICAgICAgICBkaXNhYmxlUGFyZW50U2Nyb2xsOiB0cnVlLCBcbiAgICAgICAgICAgIHRlbXBsYXRlVXJsOiAnLi9kZWxldGVjbGFzcy5odG1sJyxcbiAgICAgICAgICAgIGhhc0JhY2tkcm9wOiB0cnVlLCBcbiAgICAgICAgICAgIHRyYXBGb2N1czogdHJ1ZSwgXG4gICAgICAgICAgICBjbGlja091dHNpZGVUb0Nsb3NlOiB0cnVlLCBcbiAgICAgICAgICAgIGVzY2FwZVRvQ2xvc2U6IHRydWUsIFxuICAgICAgICAgICAgZm9jdXNPbk9wZW46IHRydWUsXG4gICAgICAgICAgICBmdWxsc2NyZWVuOiB0cnVlLCBcbiAgICAgICAgICAgIHRhcmdldEV2ZW50OiBldmVudFxuICAgICAgICB9XG5cbiAgICAgICAgJG1kRGlhbG9nLnNob3coY29uZmlnKVxuICAgICAgICAgICAgLnRoZW4oYW5zd2VyID0+IHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnYW5zd2VyOiAnLCBhbnN3ZXIpOyBcbiAgICAgICAgICAgIH0pXG5cblxuICAgIGZ1bmN0aW9uIERlbGV0ZUNsYXNzQ29udHJvbGxlcigkc3RhdGUsICRtZERpYWxvZywgJGh0dHAsIEpTT05TZXJ2aWNlLCBDb3Vyc2VNb2RlbCwgJHdpbmRvdykge1xuICAgICAgICB2YXIgY3RybCA9IHRoaXM7XG4gICAgICAgIGN0cmwuYWxsQ2xhc3NlcyA9IFtdXG4gICAgICAgIGNvbnNvbGUubG9nKFwic2VtZXN0ZXIuLi4/IFwiLCBzZW1lc3RlcilcbiAgICAgICAgQ291cnNlTW9kZWwuZ2V0Q291cnNlQnlTZW0ocGFyc2VJbnQoc2VtZXN0ZXIpKS50aGVuKGZ1bmN0aW9uKGNvdXJzZXMpIHtcbiAgICAgICAgY29uc29sZS5sb2coJ2NvdXJzZXM6ICcsIGNvdXJzZXMpOyBcbiAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBjb3Vyc2VzLmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICBjdHJsLmFsbENsYXNzZXMucHVzaChjb3Vyc2VzW2ldKVxuICAgICAgICAgICAgY29uc29sZS5sb2coY291cnNlc1tpXS5hdHRyaWJ1dGVzLmNvdXJzZU5hbWUpXG4gICAgICAgIH1cbiAgICAgICAgY29uc29sZS5sb2coJ2NvdXJzZXMgbGlzdGVkLi4uJywgY3RybC5hbGxDbGFzc2VzKVxuICAgICAgICB9KS5jYXRjaChmdW5jdGlvbigpIHtcbiAgICAgICAgY29uc29sZS5sb2coXCJjb3VsZG4ndCBmZXRjaCBjb3Vyc2VzXCIpXG4gICAgICAgIH0pXG5cbiAgICAgICAgY29uc29sZS5sb2coJ2NvdXJzZXMgbGlzdGVkLi4uJywgY3RybC5hbGxDbGFzc2VzKVxuXG4gICAgICAgIC8vIGdvIHRocm91Z2ggZWFjaCBvZiB0aGUgY2xhc3NlcyB0byBnZXQgdGhlIGRlc2NyaXB0aW9uIG9mIHRoZSBjbGFzc1xuICAgICAgICBjdHJsLmRvU2Vjb25kYXJ5QWN0aW9uID0gZnVuY3Rpb24oZXZlbnQsIGRlc2NyaXB0aW9uKSB7XG4gICAgICAgICAgICAkbWREaWFsb2cuc2hvdyhcbiAgICAgICAgICAgICAgICAkbWREaWFsb2cuYWxlcnQoKVxuICAgICAgICAgICAgICAgIC50aXRsZShcIkNvdXJzZSBEZXNjcmlwdGlvblwiKVxuICAgICAgICAgICAgICAgIC50ZXh0Q29udGVudChkZXNjcmlwdGlvbilcbiAgICAgICAgICAgICAgICAub2soJ09rJylcbiAgICAgICAgICAgICAgICAudGFyZ2V0RXZlbnQoZXZlbnQpXG4gICAgICAgICAgICApO1xuICAgICAgICB9O1xuXG4gICAgICAgIGN0cmwuYWRkQ291cnNlVG9TZW1lc3RlcldyYXBwZXIgPSBmdW5jdGlvbihldmVudCwgY291cnNlLCAkd2luZG93KSB7XG4gICAgICAgICAgICBhZGRDb3Vyc2VUb1NlbWVzdGVyKGV2ZW50LCBjb3Vyc2UpLnRoZW4oZnVuY3Rpb24oc3VjY2Vzcyl7XG4gICAgICAgICAgICAgICAgJG1kRGlhbG9nLmNhbmNlbCgpOyBcbiAgICAgICAgICAgICAgICAkd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgfVxuXG4gICAgICAgIC8vY3RybC5hZGRDb3Vyc2VUb1NlbWVzdGVyID0gZnVuY3Rpb24oZXZlbnQsIGNvdXJzZSkge1xuICAgICAgICBjdHJsLnJlbW92ZUNvdXJzZUZyb21TZW1lc3RlciA9IGZ1bmN0aW9uKGV2ZW50LCBjb3Vyc2UpIHtcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKFwic3RhcnRpbmc/XCIpXG4gICAgICAgICAgICBDb3Vyc2VNb2RlbC5nZXRCeU5hbWUoY291cnNlKS50aGVuKGZ1bmN0aW9uKGNvdXJzZSkge1xuICAgICAgICAgICAgY29uc29sZS5sb2coJ2NvdXJzZSBmb3VuZC4gaWQ6ICcsIGNvdXJzZS5pZCk7XG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc2VuZGluZyBpZCB0byBzZXRTZW1lc3RlckRlZmF1bHQnKVxuICAgICAgICAgICAgQ291cnNlTW9kZWwucmVtb3ZlU2VtZXN0ZXJEZWZhdWx0KGNvdXJzZS5pZCkudGhlbihmdW5jdGlvbihzdWNjZXNzKSB7XG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ3NldCBuZXcgZGVmYXVsdCcpXG4gICAgICAgICAgICAgICAgfSkuY2F0Y2goZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgICAgICBwb3B1bGF0ZUxpc3RzKENvdXJzZU1vZGVsKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ2ZhaWxlZCB0byBzZXQgbmV3IGRlZmF1bHQuJyk7IFxuICAgICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICB9KS5jYXRjaChmdW5jdGlvbigpIHtcbiAgICAgICAgICAgIH0pXG4gICAgICAgIH1cbiAgICB9ICAgIFxuXG5cbn1cbn1cblxuXG5hbmd1bGFyXG4gICAgLm1vZHVsZSgnY29tcG9uZW50cy5zZW1lc3RlcnMnKVxuICAgIC5jb250cm9sbGVyKCdTZW1lc3RlcnNDb250cm9sbGVyJywgU2VtZXN0ZXJzQ29udHJvbGxlcik7IiwiLyoqXG4gKiBAbmdkb2Mgc2VydmljZVxuICogQG5hbWUgY29tbW9uLnNlcnZpY2U6Q291cnNlTW9kZWxcbiAqXG4gKiBAZGVzY3JpcHRpb24gTW9kZWwgYW5kIGhlbHBlciBtZXRob2RzIGZvciBDb3Vyc2VNb2RlbCBwYXJzZSBvYmplY3QuXG4gKi9cblxuY2xhc3MgQ291cnNlTW9kZWwge1xuICAgIGNvbnN0cnVjdG9yKFBhcnNlLCBNYWpvck1vZGVsKSB7XG4gICAgICAgIHRoaXMuUGFyc2UgPSBQYXJzZTtcbiAgICAgICAgdGhpcy5NYWpvck1vZGVsID0gTWFqb3JNb2RlbFxuICAgICAgICB0aGlzLmRhdGEgPSB7fTtcbiAgICAgICAgdGhpcy5jb2xsZWN0aW9uID0gW107XG4gICAgICAgIHRoaXMubmFtZSA9ICdDb3Vyc2UnO1xuICAgICAgICB0aGlzLmZpZWxkcyA9IFtcbiAgICAgICAgICAgICdjb3Vyc2VOYW1lJyxcbiAgICAgICAgICAgICdjb3JlcXVpc2l0ZXMnLFxuICAgICAgICAgICAgJ3NlbWVzdGVyRGVmYXVsdCcsIFxuICAgICAgICAgICAgJ2NvdXJzZUlkJyxcbiAgICAgICAgICAgICdzZW1lc3RlclJlcXVpcmVkJyxcbiAgICAgICAgICAgICdhdHRyaWJ1dGVzJyxcbiAgICAgICAgICAgICdkZWZhdWx0TWFqb3InLFxuICAgICAgICAgICAgJ2NyZWRpdHMnLFxuICAgICAgICAgICAgJ3ByZXJlcXVpc2l0ZXMnXG4gICAgICAgIF07XG4gICAgfVxuICAgIE5ldyhvYmopIHtcbiAgICAgICAgaWYgKGFuZ3VsYXIuaXNVbmRlZmluZWQob2JqKSkge1xuICAgICAgICAgICAgY29uc3QgcGFyc2VPYmplY3QgPSBuZXcgdGhpcy5QYXJzZS5PYmplY3QodGhpcy5uYW1lKTtcbiAgICAgICAgICAgIHRoaXMuUGFyc2UuZGVmaW5lQXR0cmlidXRlcyhwYXJzZU9iamVjdCwgdGhpcy5maWVsZHMpO1xuICAgICAgICAgICAgLy8gcGFyc2VPYmplY3QubWFqb3IgPSBuZXcgdGhpcy5QYXJzZS5PYmplY3QodGhpcy5NYWpvck1vZGVsLm5hbWUpXG4gICAgICAgICAgICAvLyB0aGlzLlBhcnNlLmRlZmluZUF0dHJpYnV0ZXMocGFyc2VPYmplY3QubWFqb3IpOyBcbiAgICAgICAgICAgIHJldHVybiBwYXJzZU9iamVjdDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuUGFyc2UuZGVmaW5lQXR0cmlidXRlcyhvYmosIHRoaXMuZmllbGRzKTtcbiAgICAgICAgICAgIC8vIHRoaXMuUGFyc2UuZGVmaW5lQXR0cmlidXRlcyhvYmoubWFqb3IsIHRoaXMuTWFqb3JNb2RlbC5maWVsZHMpOyBcbiAgICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0QnlJZChpZCkge1xuICAgICAgICBjb25zb2xlLmxvZyhpZClcbiAgICAgICAgcmV0dXJuIG5ldyB0aGlzLlBhcnNlLlF1ZXJ5KHRoaXMuTmV3KCkpXG4gICAgICAgICAgICAuZXF1YWxUbyhcIm9iamVjdElkXCIsIGlkKVxuICAgICAgICAgICAgLmZpbmQoKVxuICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmVzdWx0JywgcmVzdWx0KVxuICAgICAgICAgICAgICAgIHRoaXMuUGFyc2UuZGVmaW5lQXR0cmlidXRlcyhyZXN1bHQsIHRoaXMuZmllbGRzKTtcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGEgPSByZXN1bHQ7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiBQcm9taXNlLnJlamVjdChlcnJvcikpO1xuICAgIH1cblxuICAgIGdldEJ5TmFtZShuYW1lKSB7XG4gICAgICAgIGNvbnNvbGUubG9nKFwibmFtZSBwYXNzZWQgaW46IFwiLCBuYW1lKVxuICAgICAgICByZXR1cm4gbmV3IHRoaXMuUGFyc2UuUXVlcnkodGhpcy5OZXcoKSlcbiAgICAgICAgICAgIC5lcXVhbFRvKFwiY291cnNlTmFtZVwiLCBuYW1lKVxuICAgICAgICAgICAgLmZpbmQoKVxuICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygncmVzdWx0OiAnLCByZXN1bHRbMF0pOyAgICAgICAgIC8vIG5vIHR3byBjb3Vyc2VzIHNob3VsZCBoYXZlIHRoZSBzYW1lIG5hbWVcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLy8gc28gc2hvdWxkIG9ubHkgYmUgb25lIHJlc3VsdFxuICAgICAgICAgICAgICAgIC8vdGhpcy5QYXJzZS5kZWZpbmVBdHRyaWJ1dGVzKHJlc3VsdFswXSwgdGhpcy5maWVsZHMpOyBcbiAgICAgICAgICAgICAgICAvL3RoaXMuZGF0YSA9IHJlc3VsdFswXTsgXG4gICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShyZXN1bHRbMF0pOyBcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gUHJvbWlzZS5yZWplY3QoZXJyb3IpKVxuICAgIH1cblxuICAgIGdldEJ5TWFqb3IobWFqb3IpIHtcbiAgICAgICAgcmV0dXJuIG5ldyB0aGlzLlBhcnNlLlF1ZXJ5KHRoaXMuTmV3KCkpXG4gICAgICAgICAgICAuaW5jbHVkZSgnbWFqb3InKVxuICAgICAgICAgICAgLmVxdWFsVG8oJ21ham9yJywgbWFqb3IpXG4gICAgICAgICAgICAuZmluZCgpXG4gICAgICAgICAgICAudGhlbihjb3Vyc2VzID0+IHtcbiAgICAgICAgICAgICAgICBjb3Vyc2VzLmZvckVhY2goY291cnNlID0+IHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5QYXJzZS5kZWZpbmVBdHRyaWJ1dGVzKGNvdXJzZSwgdGhpcy5maWVsZHMpO1xuICAgICAgICAgICAgICAgICAgICB0aGlzLlBhcnNlLmRlZmluZUF0dHJpYnV0ZXMoY291cnNlLm1ham9yLCB0aGlzLkNvdXJzZU1vZGVsLmZpZWxkcyk7XG4gICAgICAgICAgICAgICAgfSlcbiAgICAgICAgICAgICAgICB0aGlzLmNvbGxlY3Rpb24gPSBjb3Vyc2VzO1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKFwiZ2V0QnlNYWpvclwiLCB0aGlzLmNvbGxlY3Rpb24pXG4gICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShjb3Vyc2VzKTtcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gUHJvbWlzZS5yZWplY3QoZXJyb3IpKTtcbiAgICB9XG5cbiAgICBzZXRTZW1lc3RlckRlZmF1bHQoaWQsIHNlbSkge1xuICAgICAgICBteW9iaiA9IG5ldyB0aGlzLlBhcnNlLlF1ZXJ5KHRoaXMuTmV3KCkpXG4gICAgICAgICAgICAuZ2V0KGlkKVxuICAgICAgICAgICAgLnRoZW4ocmVzdWx0ID0+IHtcbiAgICAgICAgICAgICAgICAvLyB0aGlzLlBhcnNlLmRlZmluZUF0dHJpYnV0ZXMocmVzdWx0LCB0aGlzLmZpZWxkcyk7XG4gICAgICAgICAgICAgICAgLy8gdGhpcy5kYXRhID0gcmVzdWx0OyBcbiAgICAgICAgICAgICAgICByZXN1bHQuc2V0KFwic2VtZXN0ZXJEZWZhdWx0XCIsIHNlbSk7IFxuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCduZXcgZGVmYXVsdCBzaG91bGQgYmUgMzogJywgcmVzdWx0KTsgXG4gICAgICAgICAgICAgICAgcmVzdWx0LnNhdmUoKTsgXG4gICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShyZXN1bHQpOyBcbiAgICAgICAgICAgIH0pLmNhdGNoKGVycm9yID0+IFByb21pc2UucmVqZWN0KGVycm9yKSlcbiAgICB9XG5cbiAgICByZW1vdmVTZW1lc3RlckRlZmF1bHQoaWQpIHtcbiAgICAgICAgbXlvYmogPSBuZXcgdGhpcy5QYXJzZS5RdWVyeSh0aGlzLk5ldygpKVxuICAgICAgICAgICAgLmdldChpZClcbiAgICAgICAgICAgIC50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICAgICAgLy8gdGhpcy5QYXJzZS5kZWZpbmVBdHRyaWJ1dGVzKHJlc3VsdCwgdGhpcy5maWVsZHMpO1xuICAgICAgICAgICAgICAgIC8vIHRoaXMuZGF0YSA9IHJlc3VsdDsgXG4gICAgICAgICAgICAgICAgcmVzdWx0LnNldChcInNlbWVzdGVyRGVmYXVsdFwiLCBudWxsKTsgXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coJ25ldyBkZWZhdWx0IHNob3VsZCBiZSAzOiAnLCByZXN1bHQpOyBcbiAgICAgICAgICAgICAgICByZXN1bHQuc2F2ZSgpOyBcbiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHJlc3VsdCk7IFxuICAgICAgICAgICAgfSkuY2F0Y2goZXJyb3IgPT4gUHJvbWlzZS5yZWplY3QoZXJyb3IpKVxuICAgIH1cblxuICAgIGdldENvdXJzZUJ5U2VtKHNlbURlZikge1xuICAgICAgICByZXR1cm4gbmV3IHRoaXMuUGFyc2UuUXVlcnkodGhpcy5OZXcoKSlcbiAgICAgICAgICAgIC5lcXVhbFRvKFwic2VtZXN0ZXJEZWZhdWx0XCIsIHNlbURlZilcbiAgICAgICAgICAgIC5maW5kKCkudGhlbihyZXN1bHQgPT4ge1xuICAgICAgICAgICAgICAgIHRoaXMuZGF0YSA9IHJlc3VsdDtcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhcInJlc3VsdCBvZiBnZXRDb3Vyc2VCeVNlbTogXCIsIHJlc3VsdCk7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShyZXN1bHQpO1xuICAgICAgICAgICAgfSlcbiAgICAgICAgICAgIC5jYXRjaChlcnJvciA9PiBQcm9taXNlLnJlamVjdChlcnJvcikpO1xuICAgIH1cblxuICAgIGdldENvdXJzZXMoKSB7XG4gICAgICAgIHJldHVybiBuZXcgdGhpcy5QYXJzZS5RdWVyeSh0aGlzLk5ldygpKVxuICAgICAgICAgICAgLmZpbmQoKS50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIFByb21pc2UucmVzb2x2ZShyZXN1bHQpOyBcbiAgICAgICAgICAgIH0pXG4gICAgICAgICAgICAuY2F0Y2goZXJyb3IgPT4gUHJvbWlzZS5yZWplY3QoZXJyb3IpKTsgXG4gICAgfVxufVxuXG5hbmd1bGFyXG4gICAgLm1vZHVsZSgnY29tbW9uJylcbiAgICAuc2VydmljZSgnQ291cnNlTW9kZWwnLCBDb3Vyc2VNb2RlbCk7XG4iLCIvKipcbiAqIEBuZ2RvYyBzZXJ2aWNlXG4gKiBAbmFtZSBjb21tb24uc2VydmljZTpNYWpvck1vZGVsXG4gKlxuICogQGRlc2NyaXB0aW9uIE1vZGVsIGFuZCBoZWxwZXIgbWV0aG9kcyBmb3IgTWFqb3JNb2RlbCBwYXJzZSBvYmplY3QuXG4gKi9cblxuY2xhc3MgTWFqb3JNb2RlbCB7XG4gICAgY29uc3RydWN0b3IoUGFyc2UpIHtcbiAgICAgICAgdGhpcy5QYXJzZSA9IFBhcnNlO1xuICAgICAgICB0aGlzLmRhdGEgPSB7fTtcbiAgICAgICAgdGhpcy5jb2xsZWN0aW9uID0gW107XG4gICAgICAgIHRoaXMubmFtZSA9ICdNYWpvcic7XG4gICAgICAgIHRoaXMuZmllbGRzID0gW1xuICAgICAgICAgICAgJ2NyZWRpdHMnLFxuICAgICAgICAgICAgJ21ham9yTmFtZScsXG4gICAgICAgICAgICAnY29sbGVnZSdcbiAgICAgICAgXTtcbiAgICB9XG4gICAgTmV3KG9iaikge1xuICAgICAgICBpZiAoYW5ndWxhci5pc1VuZGVmaW5lZChvYmopKSB7XG4gICAgICAgICAgICBjb25zdCBwYXJzZU9iamVjdCA9IG5ldyB0aGlzLlBhcnNlLk9iamVjdCh0aGlzLm5hbWUpXG4gICAgICAgICAgICB0aGlzLlBhcnNlLmRlZmluZUF0dHJpYnV0ZXMocGFyc2VPYmplY3QsIHRoaXMuZmllbGRzKTtcbiAgICAgICAgICAgIHJldHVybiBwYXJzZU9iamVjdDtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIHRoaXMuUGFyc2UuZGVmaW5lQXR0cmlidXRlcyhvYmosIHRoaXMuZmllbGRzKTtcbiAgICAgICAgICAgIHJldHVybiBvYmo7XG4gICAgICAgIH1cbiAgICB9XG4gICAgZ2V0QnlJZChpZCkge1xuICAgICAgICByZXR1cm4gbmV3IHRoaXMuUGFyc2UuUXVlcnkodGhpcy5OZXcoKSlcbiAgICAgICAgICAgIC5nZXQoaWQpXG4gICAgICAgICAgICAudGhlbihyZXN1bHQgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyZXN1bHQnLCByZXN1bHQpXG4gICAgICAgICAgICAgICAgdGhpcy5QYXJzZS5kZWZpbmVBdHRyaWJ1dGVzKHJlc3VsdCwgdGhpcy5maWVsZHMpO1xuICAgICAgICAgICAgICAgIHRoaXMuZGF0YSA9IHJlc3VsdDtcbiAgICAgICAgICAgICAgICByZXR1cm4gUHJvbWlzZS5yZXNvbHZlKHJlc3VsdCk7XG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IFByb21pc2UucmVqZWN0KGVycm9yKSk7XG4gICAgfVxuICAgIGdldEJ5TmFtZShuYW1lKSB7XG4gICAgICAgIHJldHVybiBuZXcgdGhpcy5QYXJzZS5RdWVyeSh0aGlzLk5ldygpKVxuICAgICAgICAgICAgLmVxdWFsVG8oXCJtYWpvck5hbWVcIiwgbmFtZSlcbiAgICAgICAgICAgIC5maW5kKCkudGhlbihyZXN1bHQgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdyZXN1bHQnLCByZXN1bHQpXG4gICAgICAgICAgICAgICAgdGhpcy5QYXJzZS5kZWZpbmVBdHRyaWJ1dGVzKHJlc3VsdCwgdGhpcy5maWVsZHMpOyBcbiAgICAgICAgICAgICAgICB0aGlzLmRhdGEgPSByZXN1bHQ7IFxuICAgICAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUocmVzdWx0KTsgXG4gICAgICAgICAgICB9KVxuICAgICAgICAgICAgLmNhdGNoKGVycm9yID0+IFByb21pc2UucmVqZWN0KGVycm9yKSlcbiAgICB9XG4gICAgZ2V0TWFqb3JzKCkge1xuICAgICAgICByZXR1cm4gbmV3IHRoaXMuUGFyc2UuUXVlcnkodGhpcy5OZXcoKSlcbiAgICAgICAgLmZpbmQoKS50aGVuKHJlc3VsdCA9PiB7XG4gICAgICAgICAgICB0aGlzLmRhdGEgPSByZXN1bHRcbiAgICAgICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUocmVzdWx0KTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKGVycm9yID0+IFByb21pc2UucmVqZWN0KGVycm9yKSk7XG4gICAgfVxufVxuXG5hbmd1bGFyXG4gICAgLm1vZHVsZSgnY29tbW9uJylcbiAgICAuc2VydmljZSgnTWFqb3JNb2RlbCcsIE1ham9yTW9kZWwpO1xuIiwiY2xhc3MgSlNPTlNlcnZpY2Uge1xuICAgIGNvbnN0cnVjdG9yKCRodHRwKXtcbiAgICAgICAgdGhpcy4kaHR0cCA9ICRodHRwXG4gICAgfVxuXG4gICAgZ2V0U2VtZXN0ZXJEYXRhKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgdXJsOiAnLi4vZGF0YS5qc29uJyxcbiAgICAgICAgfSlcbiAgICB9XG4gICAgZ2V0Q2xhc3NEYXRhKCkge1xuICAgICAgICByZXR1cm4gdGhpcy4kaHR0cCh7XG4gICAgICAgICAgICBtZXRob2Q6ICdHRVQnLFxuICAgICAgICAgICAgdXJsOiAnLi4vYWRkQ2xhc3MuanNvbicsXG4gICAgICAgIH0pXG4gICAgfVxuXG59XG5cbmFuZ3VsYXJcbiAgICAubW9kdWxlKCdjb21tb24nKVxuICAgIC5zZXJ2aWNlKCdKU09OU2VydmljZScsIEpTT05TZXJ2aWNlKTsiLCJhbmd1bGFyLm1vZHVsZSgndGVtcGxhdGVzJywgW10pLnJ1bihbJyR0ZW1wbGF0ZUNhY2hlJywgZnVuY3Rpb24oJHRlbXBsYXRlQ2FjaGUpIHskdGVtcGxhdGVDYWNoZS5wdXQoJy4vcm9vdC5odG1sJywnPGRpdiBjbGFzcz1cInJvb3RcIj5cXG4gICAgPGRpdiB1aS12aWV3PjwvZGl2PlxcbjwvZGl2PicpO1xuJHRlbXBsYXRlQ2FjaGUucHV0KCcuL2FwcC1uYXYuaHRtbCcsJzxoZWFkZXI+XFxuICA8bWQtdG9vbGJhcj5cXG4gICAgICA8ZGl2IGNsYXNzPVwibWQtdG9vbGJhci10b29sc1wiIGxheW91dD1cInJvd1wiIGxheW91dC1hbGlnbj1cInNwYWNlLWJldHdlZW4gY2VudGVyXCI+XFxuICAgICAgICAgIDxkaXY+XFxuICAgICAgICAgICAgICA8YSBocmVmPVwiI1wiPjxpIGNsYXNzPVwibWF0ZXJpYWwtaWNvbnNcIj5ob21lPC9pPjwvYT5cXG4gICAgICAgICAgPC9kaXY+XFxuICAgICAgICAgIDxkaXY+XFxuICAgICAgICAgICAgICA8aDM+Q291cnNlIFBsYW5uZXI8L2gzPlxcbiAgICAgICAgICA8L2Rpdj5cXG4gICAgICA8L2Rpdj5cXG4gIDwvbWQtdG9vbGJhcj5cXG48L2hlYWRlcj4nKTtcbiR0ZW1wbGF0ZUNhY2hlLnB1dCgnLi9hcHAuaHRtbCcsJzxkaXYgY2xhc3M9XCJyb290XCI+XFxuICA8ZGl2PlxcbiAgICA8ZGl2IHVpLXZpZXc+PC9kaXY+XFxuICA8L2Rpdj5cXG48L2Rpdj4nKTtcbiR0ZW1wbGF0ZUNhY2hlLnB1dCgnLi9ob21lLmh0bWwnLCc8YXBwLW5hdj48L2FwcC1uYXY+XFxuPG1kLWlucHV0LWNvbnRhaW5lciBjbGFzcz1cIm1kLWJsb2NrXCIgZmxleC1ndC1zbT5cXG4gICAgPGgyPkNob29zZSB5b3VyIG1ham9yIHRvIGdldCBzdGFydGVkLjwvaDI+XFxuICAgIDxsYWJlbD5NeSBNYWpvcjwvbGFiZWw+XFxuICAgIDxtZC1zZWxlY3QgbmctbW9kZWw9XCJtYWpvckNob3NlblwiIG5nLWNoYW5nZT1cIm9uQ2hhbmdlKClcIj5cXG4gICAgICA8IS0tIHN0YXRlZnVsIGNvbXBvbmVudCAtLT5cXG4gICAgICA8bWQtb3B0aW9uIG5nLXJlcGVhdD1cIm1ham9yIGluICRjdHJsLm1ham9yc1wiIHZhbHVlPVwie3ttYWpvcn19XCI+XFxuICAgICAgICB7e21ham9yfX1cXG4gICAgICA8L21kLW9wdGlvbj5cXG4gICAgPC9tZC1zZWxlY3Q+XFxuICA8L21kLWlucHV0LWNvbnRhaW5lcj5cXG5cXG4gIDxtZC1idXR0b24gbWQtbm8taW5rIGNsYXNzPVwibWQtZ28tYnV0dG9uXCIgbmctY2xpY2sgPSBcInNhdmVNYWpvcigpXCIgaHJlZj1cIiMhL3NlbWVzdGVyc1wiPkdvPC9tZC1idXR0b24+Jyk7XG4kdGVtcGxhdGVDYWNoZS5wdXQoJy4vYWRkY2xhc3MuaHRtbCcsJzwhLS0gc3RhdGVmdWwgY29tcG9uZW50IC0tPlxcbiAgPG1kLWlucHV0LWNvbnRhaW5lciBjbGFzcz1cIm1kLWJsb2NrLWFkZGNsYXNzXCIgZmxleC1ndC1zbT5cXG4gICAgICA8aDEgY2xhc3M9XCJhZGRpdGlvbmFsLW9wdGlvbnNcIj5BZGRpdGlvbmFsIENsYXNzIE9wdGlvbnM8L2gxPiBcXG4gICAgPCEtLSBzdGF0ZWxlc3MgY29tcG9uZW50IC0tPlxcbiAgICA8bWQtbGlzdC1pdGVtIG5nLXJlcGVhdD1cImNvdXJzZSBpbiAkY3RybC5hbGxDbGFzc2VzXCIgdmFsdWU9XCJ7e2NvdXJzZS5hdHRyaWJ1dGVzLmNvdXJzZU5hbWV9fVwiIGNsYXNzPVwic2Vjb25kYXJ5LWJ1dHRvbi1wYWRkaW5nLWNsYXNzXCI+XFxuICAgICAgPHA+e3tjb3Vyc2UuYXR0cmlidXRlcy5jb3Vyc2VOYW1lfX08L3A+XFxuICAgICAgPG1kLWJ1dHRvbiBjbGFzcz1cIm1kLXNlY29uZGFyeVwiIG5nLWNsaWNrPVwiJGN0cmwuYWRkQ291cnNlVG9TZW1lc3RlcldyYXBwZXIoJGV2ZW50LCBjb3Vyc2UuYXR0cmlidXRlcy5jb3Vyc2VOYW1lKVwiIGhyZWY9XCIjIS9zZW1lc3RlcnNcIj5hZGQgY2xhc3M8L21kLWJ1dHRvbj5cXG4gICAgPC9tZC1saXN0LWl0ZW0+XFxuICA8L21kLWlucHV0LWNvbnRhaW5lcj5cXG4nKTtcbiR0ZW1wbGF0ZUNhY2hlLnB1dCgnLi9kZWxldGVjbGFzcy5odG1sJywnPCEtLSBzdGF0ZWZ1bCBjb21wb25lbnQgLS0+XFxuPG1kLWlucHV0LWNvbnRhaW5lciBjbGFzcz1cIm1kLWJsb2NrLWFkZGNsYXNzXCIgZmxleC1ndC1zbT5cXG4gICAgPGgxIGNsYXNzPVwiYWRkaXRpb25hbC1vcHRpb25zXCI+UmVtb3ZlIENsYXNzPC9oMT4gXFxuICA8IS0tIHN0YXRlbGVzcyBjb21wb25lbnQgLS0+XFxuICA8bWQtbGlzdC1pdGVtIG5nLXJlcGVhdD1cImNvdXJzZSBpbiAkY3RybC5hbGxDbGFzc2VzXCIgdmFsdWU9XCJ7e2NvdXJzZS5hdHRyaWJ1dGVzLmNvdXJzZU5hbWV9fVwiIGNsYXNzPVwic2Vjb25kYXJ5LWJ1dHRvbi1wYWRkaW5nLWNsYXNzXCI+XFxuICAgIDxwPnt7Y291cnNlLmF0dHJpYnV0ZXMuY291cnNlTmFtZX19PC9wPlxcbiAgICA8bWQtYnV0dG9uIGNsYXNzPVwibWQtc2Vjb25kYXJ5XCIgbmctY2xpY2s9XCIkY3RybC5yZW1vdmVDb3Vyc2VGcm9tU2VtZXN0ZXIoJGV2ZW50LCBjb3Vyc2UuYXR0cmlidXRlcy5jb3Vyc2VOYW1lKVwiIGhyZWY9XCIjIS9zZW1lc3RlcnNcIj5yZW1vdmUgY2xhc3M8L21kLWJ1dHRvbj5cXG4gIDwvbWQtbGlzdC1pdGVtPlxcbjwvbWQtaW5wdXQtY29udGFpbmVyPlxcbicpO1xuJHRlbXBsYXRlQ2FjaGUucHV0KCcuL3NlbWVzdGVycy5odG1sJywnPGFwcC1uYXY+PC9hcHAtbmF2PlxcbjxkaXYgY2xhc3M9XCJjb3Vyc2UtbWFwXCI+XFxuICAgIDxtZC1jb250ZW50IGxheW91dC1wYWRkaW5nPlxcbiAgICAgICAgPGRpdiBuZy1zaG93PVwiJGN0cmwuY2xhc3NXYXJuaW5nXCIgY2xhc3M9XCJ3YXJuaW5nLXRleHRcIj5cXG4gICAgICAgICAgICBPbmUgb3IgbW9yZSBjbGFzc2VzIG5lZWQgYWRqdXN0aW5nIHRvIHNhdGlzZnkgcHJlcmVxdWlzaXRlIHJlcXVpcmVtZW50cy4gXFxuICAgICAgICA8L2Rpdj5cXG4gICAgICAgIDwhLS0gR3JpZCBMaXN0IHRvIEtlZXAgZXZlbiBsYXlvdXQgLS0+XFxuICAgICAgICA8bWQtZ3JpZC1saXN0ICBtZC1jb2xzLXNtPVwiMVwiIG1kLWNvbHMtbWQ9XCIxXCIgbWQtY29scy1sZz1cIjJcIiBtZC1jb2xzLWd0LWxnPVwiM1wiIG1kLWNvbHM9MSBtZC1yb3ctaGVpZ2h0LW1kPVwiMToxXCIgbWQtcm93LWhlaWdodD1cIjEuMjoxXCJcXG4gICAgICAgICAgICBtZC1ndXR0ZXItZ3QtbWQ9XCIxNnB4XCIgbWQtZ3V0dGVyLW1kPVwiOHB4XCIgbWQtZ3V0dGVyPVwiNHB4XCI+XFxuICAgICAgICAgICAgPCEtLSBFYWNoIFRpbGUgaG9sZHMgYSBsaXN0IG9mIHNlbWVzdGVyIGNvdXJzZXMgLS0+XFxuICAgICAgICAgICAgPCEtLSBzdGF0ZWZ1bCBjb21wb25lbnQgLS0+XFxuICAgICAgICAgICAgPG1kLWdyaWQtdGlsZSBuZy1yZXBlYXQ9XCIoa2V5LCBzZW1lc3RlcikgaW4gJGN0cmwubW9kZWxzLnNlbWVzdGVyc1wiPlxcbiAgICAgICAgICAgICAgICA8IS0tIHVpLXNvcnRhYmxlIGFsbG93cyBkcmFnIGRyb3Agc29ydGluZyBvZiBcXG4gICAgICAgICAgICAgICAgICAgIGFycmF5cyBjb3Vyc2VNYXAgaXMgdGhlIGRyYWcgZHJvcCBncm91cCAtLT5cXG4gICAgICAgICAgICAgICAgICAgIDwhLS0gc3RhdGVsZXNzIGNvbXBvbmVudCAtLT5cXG4gICAgICAgICAgICAgICAgPG1kLWxpc3QgdWktc29ydGFibGU9XCIkY3RybC5jb3Vyc2VNYXBcIiBjbGFzcz1cImNvdXJzZS1saXN0XCIgbmctbW9kZWw9XCJzZW1lc3RlclwiPlxcbiAgICAgICAgICAgICAgICAgICAgPG1kLXN1YmhlYWRlciBjbGFzcz1cIm1kLW5vLXN0aWNreVwiPlNlbWVzdGVyIHt7JGluZGV4KzF9fTwvbWQtc3ViaGVhZGVyPlxcbiAgICAgICAgICAgICAgICAgICAgPCEtLSByZXBlYXRzIGVhY2ggY2xhc3MgaW4gYSBzZW1lc3RlciAtLT5cXG4gICAgICAgICAgICAgICAgICAgIDxtZC1saXN0LWl0ZW0gbmctcmVwZWF0PVwiaXRlbSBpbiBzZW1lc3RlclwiIGNsYXNzPVwibWQtMi1saW5lIGNvdXJzZVwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3M9XCJtZC1saXN0LWl0ZW0tdGV4dFwiPlxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB7e2l0ZW19fVxcbiAgICAgICAgICAgICAgICAgICAgICAgIDwvZGl2PlxcbiAgICAgICAgICAgICAgICAgICAgICAgIDxtZC1kaXZpZGVyPjwvbWQtZGl2aWRlcj5cXG4gICAgICAgICAgICAgICAgICAgIDwvbWQtbGlzdC1pdGVtPlxcbiAgICAgICAgICAgICAgICAgICAgPCEtLSBkaXNwbGF5IHRoZSBydW5uaW5nIHRvdGFsIG9mIGNyZWRpdHMgZm9yIGVhY2ggc2VtZXN0ZXItLT5cXG4gICAgICAgICAgICAgICAgICAgIDxkaXYgc3R5bGU9XCJtYXJnaW46IDMwcHhcIj48L2Rpdj5cXG4gICAgICAgICAgICAgICAgICAgIDxwPkNyZWRpdHM6IHt7JGN0cmwubW9kZWxzLmNyZWRpdFRvdGFsWyRpbmRleF19fVxcbiAgICAgICAgICAgICAgICAgICAgPG1kLWJ1dHRvbiBzdHlsZT1cImZsb2F0OiByaWdodDsgbWFyZ2luLXRvcDogLTEwcHhcIiBuZy1jbGljayA9IFwiJGN0cmwuZGVsZXRlQ2xhc3MoJGV2ZW50LCBrZXkpXCI+RGVsZXRlIENsYXNzPC9tZC1idXR0b24+XFxuICAgICAgICAgICAgICAgICAgICA8bWQtYnV0dG9uIHN0eWxlPVwiZmxvYXQ6IHJpZ2h0OyBtYXJnaW4tdG9wOiAtMTBweFwiIG5nLWNsaWNrID0gXCIkY3RybC5hZGRDbGFzcygkZXZlbnQsIGtleSlcIj5BZGQgQ2xhc3M8L21kLWJ1dHRvbj48L3A+XFxuICAgICAgICAgICAgICAgIDwvbWQtbGlzdD5cXG4gICAgICAgICAgICA8L21kLWdyaWQtdGlsZT5cXG4gICAgICAgIDwvbWQtZ3JpZC1saXN0PlxcbiAgICA8L21kLWNvbnRlbnQ+XFxuPC9kaXY+Jyk7fV0pOyJdfQ==
